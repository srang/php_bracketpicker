{"version":3,"names":[],"mappings":"","sources":["summernote.js"],"sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict'; /**\n * Super simple wysiwyg editor on Bootstrap v0.6.16\n * http://summernote.org/\n *\n * summernote.js\n * Copyright 2013-2015 Alan Hong. and other contributors\n * summernote may be freely distributed under the MIT license./\n *\n * Date: 2015-08-03T16:41Z\n */(function(factory){ /* global define */if(typeof define==='function'&&define.amd){ // AMD. Register as an anonymous module.\ndefine(['jquery'],factory);}else { // Browser globals: jQuery\nfactory(window.jQuery);}})(function($){if(!Array.prototype.reduce){ /**\n     * Array.prototype.reduce polyfill\n     *\n     * @param {Function} callback\n     * @param {Value} [initialValue]\n     * @return {Value}\n     *\n     * @see http://goo.gl/WNriQD\n     */Array.prototype.reduce=function(callback){var t=Object(this),len=t.length>>>0,k=0,value;if(arguments.length===2){value=arguments[1];}else {while(k<len&&!(k in t)){k++;}if(k>=len){throw new TypeError('Reduce of empty array with no initial value');}value=t[k++];}for(;k<len;k++){if(k in t){value=callback(value,t[k],k,t);}}return value;};}if('function'!==typeof Array.prototype.filter){ /**\n     * Array.prototype.filter polyfill\n     *\n     * @param {Function} func\n     * @return {Array}\n     *\n     * @see http://goo.gl/T1KFnq\n     */Array.prototype.filter=function(func){var t=Object(this),len=t.length>>>0;var res=[];var thisArg=arguments.length>=2?arguments[1]:void 0;for(var i=0;i<len;i++){if(i in t){var val=t[i];if(func.call(thisArg,val,i,t)){res.push(val);}}}return res;};}if(!Array.prototype.map){ /**\n     * Array.prototype.map polyfill\n     *\n     * @param {Function} callback\n     * @return {Array}\n     *\n     * @see https://goo.gl/SMWaMK\n     */Array.prototype.map=function(callback,thisArg){var T,A,k;if(this===null){throw new TypeError(' this is null or not defined');}var O=Object(this);var len=O.length>>>0;if(typeof callback!=='function'){throw new TypeError(callback+' is not a function');}if(arguments.length>1){T=thisArg;}A=new Array(len);k=0;while(k<len){var kValue,mappedValue;if(k in O){kValue=O[k];mappedValue=callback.call(T,kValue,k,O);A[k]=mappedValue;}k++;}return A;};}var isSupportAmd=typeof define==='function'&&define.amd; /**\n   * returns whether font is installed or not.\n   *\n   * @param {String} fontName\n   * @return {Boolean}\n   */var isFontInstalled=function isFontInstalled(fontName){var testFontName=fontName==='Comic Sans MS'?'Courier New':'Comic Sans MS';var $tester=$('<div>').css({position:'absolute',left:'-9999px',top:'-9999px',fontSize:'200px'}).text('mmmmmmmmmwwwwwww').appendTo(document.body);var originalWidth=$tester.css('fontFamily',testFontName).width();var width=$tester.css('fontFamily',fontName+','+testFontName).width();$tester.remove();return originalWidth!==width;};var userAgent=navigator.userAgent;var isMSIE=/MSIE|Trident/i.test(userAgent);var browserVersion;if(isMSIE){var matches=/MSIE (\\d+[.]\\d+)/.exec(userAgent);if(matches){browserVersion=parseFloat(matches[1]);}matches=/Trident\\/.*rv:([0-9]{1,}[\\.0-9]{0,})/.exec(userAgent);if(matches){browserVersion=parseFloat(matches[1]);}} /**\n   * @class core.agent\n   *\n   * Object which check platform and agent\n   *\n   * @singleton\n   * @alternateClassName agent\n   */var agent={ /** @property {Boolean} [isMac=false] true if this agent is Mac  */isMac:navigator.appVersion.indexOf('Mac')>-1, /** @property {Boolean} [isMSIE=false] true if this agent is a Internet Explorer  */isMSIE:isMSIE, /** @property {Boolean} [isFF=false] true if this agent is a Firefox  */isFF:/firefox/i.test(userAgent),isWebkit:/webkit/i.test(userAgent), /** @property {Boolean} [isSafari=false] true if this agent is a Safari  */isSafari:/safari/i.test(userAgent), /** @property {Float} browserVersion current browser version  */browserVersion:browserVersion, /** @property {String} jqueryVersion current jQuery version string  */jqueryVersion:parseFloat($.fn.jquery),isSupportAmd:isSupportAmd,hasCodeMirror:isSupportAmd?require.specified('CodeMirror'):!!window.CodeMirror,isFontInstalled:isFontInstalled,isW3CRangeSupport:!!document.createRange}; /**\n   * @class core.func\n   *\n   * func utils (for high-order func's arg)\n   *\n   * @singleton\n   * @alternateClassName func\n   */var func=function(){var eq=function eq(itemA){return function(itemB){return itemA===itemB;};};var eq2=function eq2(itemA,itemB){return itemA===itemB;};var peq2=function peq2(propName){return function(itemA,itemB){return itemA[propName]===itemB[propName];};};var ok=function ok(){return true;};var fail=function fail(){return false;};var not=function not(f){return function(){return !f.apply(f,arguments);};};var and=function and(fA,fB){return function(item){return fA(item)&&fB(item);};};var self=function self(a){return a;};var idCounter=0; /**\n     * generate a globally-unique id\n     *\n     * @param {String} [prefix]\n     */var uniqueId=function uniqueId(prefix){var id=++idCounter+'';return prefix?prefix+id:id;}; /**\n     * returns bnd (bounds) from rect\n     *\n     * - IE Compatability Issue: http://goo.gl/sRLOAo\n     * - Scroll Issue: http://goo.gl/sNjUc\n     *\n     * @param {Rect} rect\n     * @return {Object} bounds\n     * @return {Number} bounds.top\n     * @return {Number} bounds.left\n     * @return {Number} bounds.width\n     * @return {Number} bounds.height\n     */var rect2bnd=function rect2bnd(rect){var $document=$(document);return {top:rect.top+$document.scrollTop(),left:rect.left+$document.scrollLeft(),width:rect.right-rect.left,height:rect.bottom-rect.top};}; /**\n     * returns a copy of the object where the keys have become the values and the values the keys.\n     * @param {Object} obj\n     * @return {Object}\n     */var invertObject=function invertObject(obj){var inverted={};for(var key in obj){if(obj.hasOwnProperty(key)){inverted[obj[key]]=key;}}return inverted;}; /**\n     * @param {String} namespace\n     * @param {String} [prefix]\n     * @return {String}\n     */var namespaceToCamel=function namespaceToCamel(namespace,prefix){prefix=prefix||'';return prefix+namespace.split('.').map(function(name){return name.substring(0,1).toUpperCase()+name.substring(1);}).join('');};return {eq:eq,eq2:eq2,peq2:peq2,ok:ok,fail:fail,self:self,not:not,and:and,uniqueId:uniqueId,rect2bnd:rect2bnd,invertObject:invertObject,namespaceToCamel:namespaceToCamel};}(); /**\n   * @class core.list\n   *\n   * list utils\n   *\n   * @singleton\n   * @alternateClassName list\n   */var list=function(){ /**\n     * returns the first item of an array.\n     *\n     * @param {Array} array\n     */var head=function head(array){return array[0];}; /**\n     * returns the last item of an array.\n     *\n     * @param {Array} array\n     */var last=function last(array){return array[array.length-1];}; /**\n     * returns everything but the last entry of the array.\n     *\n     * @param {Array} array\n     */var initial=function initial(array){return array.slice(0,array.length-1);}; /**\n     * returns the rest of the items in an array.\n     *\n     * @param {Array} array\n     */var tail=function tail(array){return array.slice(1);}; /**\n     * returns item of array\n     */var find=function find(array,pred){for(var idx=0,len=array.length;idx<len;idx++){var item=array[idx];if(pred(item)){return item;}}}; /**\n     * returns true if all of the values in the array pass the predicate truth test.\n     */var all=function all(array,pred){for(var idx=0,len=array.length;idx<len;idx++){if(!pred(array[idx])){return false;}}return true;}; /**\n     * returns index of item\n     */var indexOf=function indexOf(array,item){return $.inArray(item,array);}; /**\n     * returns true if the value is present in the list.\n     */var contains=function contains(array,item){return indexOf(array,item)!==-1;}; /**\n     * get sum from a list\n     *\n     * @param {Array} array - array\n     * @param {Function} fn - iterator\n     */var sum=function sum(array,fn){fn=fn||func.self;return array.reduce(function(memo,v){return memo+fn(v);},0);}; /**\n     * returns a copy of the collection with array type.\n     * @param {Collection} collection - collection eg) node.childNodes, ...\n     */var from=function from(collection){var result=[],idx=-1,length=collection.length;while(++idx<length){result[idx]=collection[idx];}return result;}; /**\n     * cluster elements by predicate function.\n     *\n     * @param {Array} array - array\n     * @param {Function} fn - predicate function for cluster rule\n     * @param {Array[]}\n     */var clusterBy=function clusterBy(array,fn){if(!array.length){return [];}var aTail=tail(array);return aTail.reduce(function(memo,v){var aLast=last(memo);if(fn(last(aLast),v)){aLast[aLast.length]=v;}else {memo[memo.length]=[v];}return memo;},[[head(array)]]);}; /**\n     * returns a copy of the array with all falsy values removed\n     *\n     * @param {Array} array - array\n     * @param {Function} fn - predicate function for cluster rule\n     */var compact=function compact(array){var aResult=[];for(var idx=0,len=array.length;idx<len;idx++){if(array[idx]){aResult.push(array[idx]);}}return aResult;}; /**\n     * produces a duplicate-free version of the array\n     *\n     * @param {Array} array\n     */var unique=function unique(array){var results=[];for(var idx=0,len=array.length;idx<len;idx++){if(!contains(results,array[idx])){results.push(array[idx]);}}return results;}; /**\n     * returns next item.\n     * @param {Array} array\n     */var next=function next(array,item){var idx=indexOf(array,item);if(idx===-1){return null;}return array[idx+1];}; /**\n     * returns prev item.\n     * @param {Array} array\n     */var prev=function prev(array,item){var idx=indexOf(array,item);if(idx===-1){return null;}return array[idx-1];};return {head:head,last:last,initial:initial,tail:tail,prev:prev,next:next,find:find,contains:contains,all:all,sum:sum,from:from,clusterBy:clusterBy,compact:compact,unique:unique};}();var NBSP_CHAR=String.fromCharCode(160);var ZERO_WIDTH_NBSP_CHAR='ï»¿'; /**\n   * @class core.dom\n   *\n   * Dom functions\n   *\n   * @singleton\n   * @alternateClassName dom\n   */var dom=function(){ /**\n     * @method isEditable\n     *\n     * returns whether node is `note-editable` or not.\n     *\n     * @param {Node} node\n     * @return {Boolean}\n     */var isEditable=function isEditable(node){return node&&$(node).hasClass('note-editable');}; /**\n     * @method isControlSizing\n     *\n     * returns whether node is `note-control-sizing` or not.\n     *\n     * @param {Node} node\n     * @return {Boolean}\n     */var isControlSizing=function isControlSizing(node){return node&&$(node).hasClass('note-control-sizing');}; /**\n     * @method  buildLayoutInfo\n     *\n     * build layoutInfo from $editor(.note-editor)\n     *\n     * @param {jQuery} $editor\n     * @return {Object}\n     * @return {Function} return.editor\n     * @return {Node} return.dropzone\n     * @return {Node} return.toolbar\n     * @return {Node} return.editable\n     * @return {Node} return.codable\n     * @return {Node} return.popover\n     * @return {Node} return.handle\n     * @return {Node} return.dialog\n     */var buildLayoutInfo=function buildLayoutInfo($editor){var makeFinder; // air mode\nif($editor.hasClass('note-air-editor')){var id=list.last($editor.attr('id').split('-'));makeFinder=function makeFinder(sIdPrefix){return function(){return $(sIdPrefix+id);};};return {editor:function editor(){return $editor;},holder:function holder(){return $editor.data('holder');},editable:function editable(){return $editor;},popover:makeFinder('#note-popover-'),handle:makeFinder('#note-handle-'),dialog:makeFinder('#note-dialog-')}; // frame mode\n}else {makeFinder=function makeFinder(className,$base){$base=$base||$editor;return function(){return $base.find(className);};};var options=$editor.data('options');var $dialogHolder=options&&options.dialogsInBody?$(document.body):null;return {editor:function editor(){return $editor;},holder:function holder(){return $editor.data('holder');},dropzone:makeFinder('.note-dropzone'),toolbar:makeFinder('.note-toolbar'),editable:makeFinder('.note-editable'),codable:makeFinder('.note-codable'),statusbar:makeFinder('.note-statusbar'),popover:makeFinder('.note-popover'),handle:makeFinder('.note-handle'),dialog:makeFinder('.note-dialog',$dialogHolder)};}}; /**\n     * returns makeLayoutInfo from editor's descendant node.\n     *\n     * @private\n     * @param {Node} descendant\n     * @return {Object}\n     */var makeLayoutInfo=function makeLayoutInfo(descendant){var $target=$(descendant).closest('.note-editor, .note-air-editor, .note-air-layout');if(!$target.length){return null;}var $editor;if($target.is('.note-editor, .note-air-editor')){$editor=$target;}else {$editor=$('#note-editor-'+list.last($target.attr('id').split('-')));}return buildLayoutInfo($editor);}; /**\n     * @method makePredByNodeName\n     *\n     * returns predicate which judge whether nodeName is same\n     *\n     * @param {String} nodeName\n     * @return {Function}\n     */var makePredByNodeName=function makePredByNodeName(nodeName){nodeName=nodeName.toUpperCase();return function(node){return node&&node.nodeName.toUpperCase()===nodeName;};}; /**\n     * @method isText\n     *\n     *\n     *\n     * @param {Node} node\n     * @return {Boolean} true if node's type is text(3)\n     */var isText=function isText(node){return node&&node.nodeType===3;}; /**\n     * ex) br, col, embed, hr, img, input, ...\n     * @see http://www.w3.org/html/wg/drafts/html/master/syntax.html#void-elements\n     */var isVoid=function isVoid(node){return node&&/^BR|^IMG|^HR|^IFRAME|^BUTTON/.test(node.nodeName.toUpperCase());};var isPara=function isPara(node){if(isEditable(node)){return false;} // Chrome(v31.0), FF(v25.0.1) use DIV for paragraph\nreturn node&&/^DIV|^P|^LI|^H[1-7]/.test(node.nodeName.toUpperCase());};var isLi=makePredByNodeName('LI');var isPurePara=function isPurePara(node){return isPara(node)&&!isLi(node);};var isTable=makePredByNodeName('TABLE');var isInline=function isInline(node){return !isBodyContainer(node)&&!isList(node)&&!isHr(node)&&!isPara(node)&&!isTable(node)&&!isBlockquote(node);};var isList=function isList(node){return node&&/^UL|^OL/.test(node.nodeName.toUpperCase());};var isHr=makePredByNodeName('HR');var isCell=function isCell(node){return node&&/^TD|^TH/.test(node.nodeName.toUpperCase());};var isBlockquote=makePredByNodeName('BLOCKQUOTE');var isBodyContainer=function isBodyContainer(node){return isCell(node)||isBlockquote(node)||isEditable(node);};var isAnchor=makePredByNodeName('A');var isParaInline=function isParaInline(node){return isInline(node)&&!!ancestor(node,isPara);};var isBodyInline=function isBodyInline(node){return isInline(node)&&!ancestor(node,isPara);};var isBody=makePredByNodeName('BODY'); /**\n     * returns whether nodeB is closest sibling of nodeA\n     *\n     * @param {Node} nodeA\n     * @param {Node} nodeB\n     * @return {Boolean}\n     */var isClosestSibling=function isClosestSibling(nodeA,nodeB){return nodeA.nextSibling===nodeB||nodeA.previousSibling===nodeB;}; /**\n     * returns array of closest siblings with node\n     *\n     * @param {Node} node\n     * @param {function} [pred] - predicate function\n     * @return {Node[]}\n     */var withClosestSiblings=function withClosestSiblings(node,pred){pred=pred||func.ok;var siblings=[];if(node.previousSibling&&pred(node.previousSibling)){siblings.push(node.previousSibling);}siblings.push(node);if(node.nextSibling&&pred(node.nextSibling)){siblings.push(node.nextSibling);}return siblings;}; /**\n     * blank HTML for cursor position\n     * - [workaround] old IE only works with &nbsp;\n     * - [workaround] IE11 and other browser works with bogus br\n     */var blankHTML=agent.isMSIE&&agent.browserVersion<11?'&nbsp;':'<br>'; /**\n     * @method nodeLength\n     *\n     * returns #text's text size or element's childNodes size\n     *\n     * @param {Node} node\n     */var nodeLength=function nodeLength(node){if(isText(node)){return node.nodeValue.length;}return node.childNodes.length;}; /**\n     * returns whether node is empty or not.\n     *\n     * @param {Node} node\n     * @return {Boolean}\n     */var isEmpty=function isEmpty(node){var len=nodeLength(node);if(len===0){return true;}else if(!isText(node)&&len===1&&node.innerHTML===blankHTML){ // ex) <p><br></p>, <span><br></span>\nreturn true;}else if(list.all(node.childNodes,isText)&&node.innerHTML===''){ // ex) <p></p>, <span></span>\nreturn true;}return false;}; /**\n     * padding blankHTML if node is empty (for cursor position)\n     */var paddingBlankHTML=function paddingBlankHTML(node){if(!isVoid(node)&&!nodeLength(node)){node.innerHTML=blankHTML;}}; /**\n     * find nearest ancestor predicate hit\n     *\n     * @param {Node} node\n     * @param {Function} pred - predicate function\n     */var ancestor=function ancestor(node,pred){while(node){if(pred(node)){return node;}if(isEditable(node)){break;}node=node.parentNode;}return null;}; /**\n     * find nearest ancestor only single child blood line and predicate hit\n     *\n     * @param {Node} node\n     * @param {Function} pred - predicate function\n     */var singleChildAncestor=function singleChildAncestor(node,pred){node=node.parentNode;while(node){if(nodeLength(node)!==1){break;}if(pred(node)){return node;}if(isEditable(node)){break;}node=node.parentNode;}return null;}; /**\n     * returns new array of ancestor nodes (until predicate hit).\n     *\n     * @param {Node} node\n     * @param {Function} [optional] pred - predicate function\n     */var listAncestor=function listAncestor(node,pred){pred=pred||func.fail;var ancestors=[];ancestor(node,function(el){if(!isEditable(el)){ancestors.push(el);}return pred(el);});return ancestors;}; /**\n     * find farthest ancestor predicate hit\n     */var lastAncestor=function lastAncestor(node,pred){var ancestors=listAncestor(node);return list.last(ancestors.filter(pred));}; /**\n     * returns common ancestor node between two nodes.\n     *\n     * @param {Node} nodeA\n     * @param {Node} nodeB\n     */var commonAncestor=function commonAncestor(nodeA,nodeB){var ancestors=listAncestor(nodeA);for(var n=nodeB;n;n=n.parentNode){if($.inArray(n,ancestors)>-1){return n;}}return null; // difference document area\n}; /**\n     * listing all previous siblings (until predicate hit).\n     *\n     * @param {Node} node\n     * @param {Function} [optional] pred - predicate function\n     */var listPrev=function listPrev(node,pred){pred=pred||func.fail;var nodes=[];while(node){if(pred(node)){break;}nodes.push(node);node=node.previousSibling;}return nodes;}; /**\n     * listing next siblings (until predicate hit).\n     *\n     * @param {Node} node\n     * @param {Function} [pred] - predicate function\n     */var listNext=function listNext(node,pred){pred=pred||func.fail;var nodes=[];while(node){if(pred(node)){break;}nodes.push(node);node=node.nextSibling;}return nodes;}; /**\n     * listing descendant nodes\n     *\n     * @param {Node} node\n     * @param {Function} [pred] - predicate function\n     */var listDescendant=function listDescendant(node,pred){var descendents=[];pred=pred||func.ok; // start DFS(depth first search) with node\n(function fnWalk(current){if(node!==current&&pred(current)){descendents.push(current);}for(var idx=0,len=current.childNodes.length;idx<len;idx++){fnWalk(current.childNodes[idx]);}})(node);return descendents;}; /**\n     * wrap node with new tag.\n     *\n     * @param {Node} node\n     * @param {Node} tagName of wrapper\n     * @return {Node} - wrapper\n     */var wrap=function wrap(node,wrapperName){var parent=node.parentNode;var wrapper=$('<'+wrapperName+'>')[0];parent.insertBefore(wrapper,node);wrapper.appendChild(node);return wrapper;}; /**\n     * insert node after preceding\n     *\n     * @param {Node} node\n     * @param {Node} preceding - predicate function\n     */var insertAfter=function insertAfter(node,preceding){var next=preceding.nextSibling,parent=preceding.parentNode;if(next){parent.insertBefore(node,next);}else {parent.appendChild(node);}return node;}; /**\n     * append elements.\n     *\n     * @param {Node} node\n     * @param {Collection} aChild\n     */var appendChildNodes=function appendChildNodes(node,aChild){$.each(aChild,function(idx,child){node.appendChild(child);});return node;}; /**\n     * returns whether boundaryPoint is left edge or not.\n     *\n     * @param {BoundaryPoint} point\n     * @return {Boolean}\n     */var isLeftEdgePoint=function isLeftEdgePoint(point){return point.offset===0;}; /**\n     * returns whether boundaryPoint is right edge or not.\n     *\n     * @param {BoundaryPoint} point\n     * @return {Boolean}\n     */var isRightEdgePoint=function isRightEdgePoint(point){return point.offset===nodeLength(point.node);}; /**\n     * returns whether boundaryPoint is edge or not.\n     *\n     * @param {BoundaryPoint} point\n     * @return {Boolean}\n     */var isEdgePoint=function isEdgePoint(point){return isLeftEdgePoint(point)||isRightEdgePoint(point);}; /**\n     * returns wheter node is left edge of ancestor or not.\n     *\n     * @param {Node} node\n     * @param {Node} ancestor\n     * @return {Boolean}\n     */var isLeftEdgeOf=function isLeftEdgeOf(node,ancestor){while(node&&node!==ancestor){if(position(node)!==0){return false;}node=node.parentNode;}return true;}; /**\n     * returns whether node is right edge of ancestor or not.\n     *\n     * @param {Node} node\n     * @param {Node} ancestor\n     * @return {Boolean}\n     */var isRightEdgeOf=function isRightEdgeOf(node,ancestor){while(node&&node!==ancestor){if(position(node)!==nodeLength(node.parentNode)-1){return false;}node=node.parentNode;}return true;}; /**\n     * returns whether point is left edge of ancestor or not.\n     * @param {BoundaryPoint} point\n     * @param {Node} ancestor\n     * @return {Boolean}\n     */var isLeftEdgePointOf=function isLeftEdgePointOf(point,ancestor){return isLeftEdgePoint(point)&&isLeftEdgeOf(point.node,ancestor);}; /**\n     * returns whether point is right edge of ancestor or not.\n     * @param {BoundaryPoint} point\n     * @param {Node} ancestor\n     * @return {Boolean}\n     */var isRightEdgePointOf=function isRightEdgePointOf(point,ancestor){return isRightEdgePoint(point)&&isRightEdgeOf(point.node,ancestor);}; /**\n     * returns offset from parent.\n     *\n     * @param {Node} node\n     */var position=function position(node){var offset=0;while(node=node.previousSibling){offset+=1;}return offset;};var hasChildren=function hasChildren(node){return !!(node&&node.childNodes&&node.childNodes.length);}; /**\n     * returns previous boundaryPoint\n     *\n     * @param {BoundaryPoint} point\n     * @param {Boolean} isSkipInnerOffset\n     * @return {BoundaryPoint}\n     */var prevPoint=function prevPoint(point,isSkipInnerOffset){var node,offset;if(point.offset===0){if(isEditable(point.node)){return null;}node=point.node.parentNode;offset=position(point.node);}else if(hasChildren(point.node)){node=point.node.childNodes[point.offset-1];offset=nodeLength(node);}else {node=point.node;offset=isSkipInnerOffset?0:point.offset-1;}return {node:node,offset:offset};}; /**\n     * returns next boundaryPoint\n     *\n     * @param {BoundaryPoint} point\n     * @param {Boolean} isSkipInnerOffset\n     * @return {BoundaryPoint}\n     */var nextPoint=function nextPoint(point,isSkipInnerOffset){var node,offset;if(nodeLength(point.node)===point.offset){if(isEditable(point.node)){return null;}node=point.node.parentNode;offset=position(point.node)+1;}else if(hasChildren(point.node)){node=point.node.childNodes[point.offset];offset=0;}else {node=point.node;offset=isSkipInnerOffset?nodeLength(point.node):point.offset+1;}return {node:node,offset:offset};}; /**\n     * returns whether pointA and pointB is same or not.\n     *\n     * @param {BoundaryPoint} pointA\n     * @param {BoundaryPoint} pointB\n     * @return {Boolean}\n     */var isSamePoint=function isSamePoint(pointA,pointB){return pointA.node===pointB.node&&pointA.offset===pointB.offset;}; /**\n     * returns whether point is visible (can set cursor) or not.\n     * \n     * @param {BoundaryPoint} point\n     * @return {Boolean}\n     */var isVisiblePoint=function isVisiblePoint(point){if(isText(point.node)||!hasChildren(point.node)||isEmpty(point.node)){return true;}var leftNode=point.node.childNodes[point.offset-1];var rightNode=point.node.childNodes[point.offset];if((!leftNode||isVoid(leftNode))&&(!rightNode||isVoid(rightNode))){return true;}return false;}; /**\n     * @method prevPointUtil\n     *\n     * @param {BoundaryPoint} point\n     * @param {Function} pred\n     * @return {BoundaryPoint}\n     */var prevPointUntil=function prevPointUntil(point,pred){while(point){if(pred(point)){return point;}point=prevPoint(point);}return null;}; /**\n     * @method nextPointUntil\n     *\n     * @param {BoundaryPoint} point\n     * @param {Function} pred\n     * @return {BoundaryPoint}\n     */var nextPointUntil=function nextPointUntil(point,pred){while(point){if(pred(point)){return point;}point=nextPoint(point);}return null;}; /**\n     * returns whether point has character or not.\n     *\n     * @param {Point} point\n     * @return {Boolean}\n     */var isCharPoint=function isCharPoint(point){if(!isText(point.node)){return false;}var ch=point.node.nodeValue.charAt(point.offset-1);return ch&&ch!==' '&&ch!==NBSP_CHAR;}; /**\n     * @method walkPoint\n     *\n     * @param {BoundaryPoint} startPoint\n     * @param {BoundaryPoint} endPoint\n     * @param {Function} handler\n     * @param {Boolean} isSkipInnerOffset\n     */var walkPoint=function walkPoint(startPoint,endPoint,handler,isSkipInnerOffset){var point=startPoint;while(point){handler(point);if(isSamePoint(point,endPoint)){break;}var isSkipOffset=isSkipInnerOffset&&startPoint.node!==point.node&&endPoint.node!==point.node;point=nextPoint(point,isSkipOffset);}}; /**\n     * @method makeOffsetPath\n     *\n     * return offsetPath(array of offset) from ancestor\n     *\n     * @param {Node} ancestor - ancestor node\n     * @param {Node} node\n     */var makeOffsetPath=function makeOffsetPath(ancestor,node){var ancestors=listAncestor(node,func.eq(ancestor));return ancestors.map(position).reverse();}; /**\n     * @method fromOffsetPath\n     *\n     * return element from offsetPath(array of offset)\n     *\n     * @param {Node} ancestor - ancestor node\n     * @param {array} offsets - offsetPath\n     */var fromOffsetPath=function fromOffsetPath(ancestor,offsets){var current=ancestor;for(var i=0,len=offsets.length;i<len;i++){if(current.childNodes.length<=offsets[i]){current=current.childNodes[current.childNodes.length-1];}else {current=current.childNodes[offsets[i]];}}return current;}; /**\n     * @method splitNode\n     *\n     * split element or #text\n     *\n     * @param {BoundaryPoint} point\n     * @param {Object} [options]\n     * @param {Boolean} [options.isSkipPaddingBlankHTML] - default: false\n     * @param {Boolean} [options.isNotSplitEdgePoint] - default: false\n     * @return {Node} right node of boundaryPoint\n     */var splitNode=function splitNode(point,options){var isSkipPaddingBlankHTML=options&&options.isSkipPaddingBlankHTML;var isNotSplitEdgePoint=options&&options.isNotSplitEdgePoint; // edge case\nif(isEdgePoint(point)&&(isText(point.node)||isNotSplitEdgePoint)){if(isLeftEdgePoint(point)){return point.node;}else if(isRightEdgePoint(point)){return point.node.nextSibling;}} // split #text\nif(isText(point.node)){return point.node.splitText(point.offset);}else {var childNode=point.node.childNodes[point.offset];var clone=insertAfter(point.node.cloneNode(false),point.node);appendChildNodes(clone,listNext(childNode));if(!isSkipPaddingBlankHTML){paddingBlankHTML(point.node);paddingBlankHTML(clone);}return clone;}}; /**\n     * @method splitTree\n     *\n     * split tree by point\n     *\n     * @param {Node} root - split root\n     * @param {BoundaryPoint} point\n     * @param {Object} [options]\n     * @param {Boolean} [options.isSkipPaddingBlankHTML] - default: false\n     * @param {Boolean} [options.isNotSplitEdgePoint] - default: false\n     * @return {Node} right node of boundaryPoint\n     */var splitTree=function splitTree(root,point,options){ // ex) [#text, <span>, <p>]\nvar ancestors=listAncestor(point.node,func.eq(root));if(!ancestors.length){return null;}else if(ancestors.length===1){return splitNode(point,options);}return ancestors.reduce(function(node,parent){if(node===point.node){node=splitNode(point,options);}return splitNode({node:parent,offset:node?dom.position(node):nodeLength(parent)},options);});}; /**\n     * split point\n     *\n     * @param {Point} point\n     * @param {Boolean} isInline\n     * @return {Object}\n     */var splitPoint=function splitPoint(point,isInline){ // find splitRoot, container\n//  - inline: splitRoot is a child of paragraph\n//  - block: splitRoot is a child of bodyContainer\nvar pred=isInline?isPara:isBodyContainer;var ancestors=listAncestor(point.node,pred);var topAncestor=list.last(ancestors)||point.node;var splitRoot,container;if(pred(topAncestor)){splitRoot=ancestors[ancestors.length-2];container=topAncestor;}else {splitRoot=topAncestor;container=splitRoot.parentNode;} // if splitRoot is exists, split with splitTree\nvar pivot=splitRoot&&splitTree(splitRoot,point,{isSkipPaddingBlankHTML:isInline,isNotSplitEdgePoint:isInline}); // if container is point.node, find pivot with point.offset\nif(!pivot&&container===point.node){pivot=point.node.childNodes[point.offset];}return {rightNode:pivot,container:container};};var create=function create(nodeName){return document.createElement(nodeName);};var createText=function createText(text){return document.createTextNode(text);}; /**\n     * @method remove\n     *\n     * remove node, (isRemoveChild: remove child or not)\n     *\n     * @param {Node} node\n     * @param {Boolean} isRemoveChild\n     */var remove=function remove(node,isRemoveChild){if(!node||!node.parentNode){return;}if(node.removeNode){return node.removeNode(isRemoveChild);}var parent=node.parentNode;if(!isRemoveChild){var nodes=[];var i,len;for(i=0,len=node.childNodes.length;i<len;i++){nodes.push(node.childNodes[i]);}for(i=0,len=nodes.length;i<len;i++){parent.insertBefore(nodes[i],node);}}parent.removeChild(node);}; /**\n     * @method removeWhile\n     *\n     * @param {Node} node\n     * @param {Function} pred\n     */var removeWhile=function removeWhile(node,pred){while(node){if(isEditable(node)||!pred(node)){break;}var parent=node.parentNode;remove(node);node=parent;}}; /**\n     * @method replace\n     *\n     * replace node with provided nodeName\n     *\n     * @param {Node} node\n     * @param {String} nodeName\n     * @return {Node} - new node\n     */var replace=function replace(node,nodeName){if(node.nodeName.toUpperCase()===nodeName.toUpperCase()){return node;}var newNode=create(nodeName);if(node.style.cssText){newNode.style.cssText=node.style.cssText;}appendChildNodes(newNode,list.from(node.childNodes));insertAfter(newNode,node);remove(node);return newNode;};var isTextarea=makePredByNodeName('TEXTAREA'); /**\n     * @param {jQuery} $node\n     * @param {Boolean} [stripLinebreaks] - default: false\n     */var value=function value($node,stripLinebreaks){var val=isTextarea($node[0])?$node.val():$node.html();if(stripLinebreaks){return val.replace(/[\\n\\r]/g,'');}return val;}; /**\n     * @method html\n     *\n     * get the HTML contents of node\n     *\n     * @param {jQuery} $node\n     * @param {Boolean} [isNewlineOnBlock]\n     */var html=function html($node,isNewlineOnBlock){var markup=value($node);if(isNewlineOnBlock){var regexTag=/<(\\/?)(\\b(?!!)[^>\\s]*)(.*?)(\\s*\\/?>)/g;markup=markup.replace(regexTag,function(match,endSlash,name){name=name.toUpperCase();var isEndOfInlineContainer=/^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(name)&&!!endSlash;var isBlockNode=/^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(name);return match+(isEndOfInlineContainer||isBlockNode?'\\n':'');});markup=$.trim(markup);}return markup;};return { /** @property {String} NBSP_CHAR */NBSP_CHAR:NBSP_CHAR, /** @property {String} ZERO_WIDTH_NBSP_CHAR */ZERO_WIDTH_NBSP_CHAR:ZERO_WIDTH_NBSP_CHAR, /** @property {String} blank */blank:blankHTML, /** @property {String} emptyPara */emptyPara:'<p>'+blankHTML+'</p>',makePredByNodeName:makePredByNodeName,isEditable:isEditable,isControlSizing:isControlSizing,buildLayoutInfo:buildLayoutInfo,makeLayoutInfo:makeLayoutInfo,isText:isText,isVoid:isVoid,isPara:isPara,isPurePara:isPurePara,isInline:isInline,isBlock:func.not(isInline),isBodyInline:isBodyInline,isBody:isBody,isParaInline:isParaInline,isList:isList,isTable:isTable,isCell:isCell,isBlockquote:isBlockquote,isBodyContainer:isBodyContainer,isAnchor:isAnchor,isDiv:makePredByNodeName('DIV'),isLi:isLi,isBR:makePredByNodeName('BR'),isSpan:makePredByNodeName('SPAN'),isB:makePredByNodeName('B'),isU:makePredByNodeName('U'),isS:makePredByNodeName('S'),isI:makePredByNodeName('I'),isImg:makePredByNodeName('IMG'),isTextarea:isTextarea,isEmpty:isEmpty,isEmptyAnchor:func.and(isAnchor,isEmpty),isClosestSibling:isClosestSibling,withClosestSiblings:withClosestSiblings,nodeLength:nodeLength,isLeftEdgePoint:isLeftEdgePoint,isRightEdgePoint:isRightEdgePoint,isEdgePoint:isEdgePoint,isLeftEdgeOf:isLeftEdgeOf,isRightEdgeOf:isRightEdgeOf,isLeftEdgePointOf:isLeftEdgePointOf,isRightEdgePointOf:isRightEdgePointOf,prevPoint:prevPoint,nextPoint:nextPoint,isSamePoint:isSamePoint,isVisiblePoint:isVisiblePoint,prevPointUntil:prevPointUntil,nextPointUntil:nextPointUntil,isCharPoint:isCharPoint,walkPoint:walkPoint,ancestor:ancestor,singleChildAncestor:singleChildAncestor,listAncestor:listAncestor,lastAncestor:lastAncestor,listNext:listNext,listPrev:listPrev,listDescendant:listDescendant,commonAncestor:commonAncestor,wrap:wrap,insertAfter:insertAfter,appendChildNodes:appendChildNodes,position:position,hasChildren:hasChildren,makeOffsetPath:makeOffsetPath,fromOffsetPath:fromOffsetPath,splitTree:splitTree,splitPoint:splitPoint,create:create,createText:createText,remove:remove,removeWhile:removeWhile,replace:replace,html:html,value:value};}();var range=function(){ /**\n     * return boundaryPoint from TextRange, inspired by Andy Na's HuskyRange.js\n     *\n     * @param {TextRange} textRange\n     * @param {Boolean} isStart\n     * @return {BoundaryPoint}\n     *\n     * @see http://msdn.microsoft.com/en-us/library/ie/ms535872(v=vs.85).aspx\n     */var textRangeToPoint=function textRangeToPoint(textRange,isStart){var container=textRange.parentElement(),offset;var tester=document.body.createTextRange(),prevContainer;var childNodes=list.from(container.childNodes);for(offset=0;offset<childNodes.length;offset++){if(dom.isText(childNodes[offset])){continue;}tester.moveToElementText(childNodes[offset]);if(tester.compareEndPoints('StartToStart',textRange)>=0){break;}prevContainer=childNodes[offset];}if(offset!==0&&dom.isText(childNodes[offset-1])){var textRangeStart=document.body.createTextRange(),curTextNode=null;textRangeStart.moveToElementText(prevContainer||container);textRangeStart.collapse(!prevContainer);curTextNode=prevContainer?prevContainer.nextSibling:container.firstChild;var pointTester=textRange.duplicate();pointTester.setEndPoint('StartToStart',textRangeStart);var textCount=pointTester.text.replace(/[\\r\\n]/g,'').length;while(textCount>curTextNode.nodeValue.length&&curTextNode.nextSibling){textCount-=curTextNode.nodeValue.length;curTextNode=curTextNode.nextSibling;} /* jshint ignore:start */var dummy=curTextNode.nodeValue; // enforce IE to re-reference curTextNode, hack\n/* jshint ignore:end */if(isStart&&curTextNode.nextSibling&&dom.isText(curTextNode.nextSibling)&&textCount===curTextNode.nodeValue.length){textCount-=curTextNode.nodeValue.length;curTextNode=curTextNode.nextSibling;}container=curTextNode;offset=textCount;}return {cont:container,offset:offset};}; /**\n     * return TextRange from boundary point (inspired by google closure-library)\n     * @param {BoundaryPoint} point\n     * @return {TextRange}\n     */var pointToTextRange=function pointToTextRange(point){var textRangeInfo=function textRangeInfo(container,offset){var node,isCollapseToStart;if(dom.isText(container)){var prevTextNodes=dom.listPrev(container,func.not(dom.isText));var prevContainer=list.last(prevTextNodes).previousSibling;node=prevContainer||container.parentNode;offset+=list.sum(list.tail(prevTextNodes),dom.nodeLength);isCollapseToStart=!prevContainer;}else {node=container.childNodes[offset]||container;if(dom.isText(node)){return textRangeInfo(node,0);}offset=0;isCollapseToStart=false;}return {node:node,collapseToStart:isCollapseToStart,offset:offset};};var textRange=document.body.createTextRange();var info=textRangeInfo(point.node,point.offset);textRange.moveToElementText(info.node);textRange.collapse(info.collapseToStart);textRange.moveStart('character',info.offset);return textRange;}; /**\n     * Wrapped Range\n     *\n     * @constructor\n     * @param {Node} sc - start container\n     * @param {Number} so - start offset\n     * @param {Node} ec - end container\n     * @param {Number} eo - end offset\n     */var WrappedRange=function WrappedRange(sc,so,ec,eo){this.sc=sc;this.so=so;this.ec=ec;this.eo=eo; // nativeRange: get nativeRange from sc, so, ec, eo\nvar nativeRange=function nativeRange(){if(agent.isW3CRangeSupport){var w3cRange=document.createRange();w3cRange.setStart(sc,so);w3cRange.setEnd(ec,eo);return w3cRange;}else {var textRange=pointToTextRange({node:sc,offset:so});textRange.setEndPoint('EndToEnd',pointToTextRange({node:ec,offset:eo}));return textRange;}};this.getPoints=function(){return {sc:sc,so:so,ec:ec,eo:eo};};this.getStartPoint=function(){return {node:sc,offset:so};};this.getEndPoint=function(){return {node:ec,offset:eo};}; /**\n       * select update visible range\n       */this.select=function(){var nativeRng=nativeRange();if(agent.isW3CRangeSupport){var selection=document.getSelection();if(selection.rangeCount>0){selection.removeAllRanges();}selection.addRange(nativeRng);}else {nativeRng.select();}return this;}; /**\n       * @return {WrappedRange}\n       */this.normalize=function(){ /**\n         * @param {BoundaryPoint} point\n         * @param {Boolean} isLeftToRight\n         * @return {BoundaryPoint}\n         */var getVisiblePoint=function getVisiblePoint(point,isLeftToRight){if(dom.isVisiblePoint(point)&&!dom.isEdgePoint(point)||dom.isVisiblePoint(point)&&dom.isRightEdgePoint(point)&&!isLeftToRight||dom.isVisiblePoint(point)&&dom.isLeftEdgePoint(point)&&isLeftToRight||dom.isVisiblePoint(point)&&dom.isBlock(point.node)&&dom.isEmpty(point.node)){return point;} // point on block's edge\nvar block=dom.ancestor(point.node,dom.isBlock);if((dom.isLeftEdgePointOf(point,block)||dom.isVoid(dom.prevPoint(point).node))&&!isLeftToRight||(dom.isRightEdgePointOf(point,block)||dom.isVoid(dom.nextPoint(point).node))&&isLeftToRight){ // returns point already on visible point\nif(dom.isVisiblePoint(point)){return point;} // reverse direction \nisLeftToRight=!isLeftToRight;}var nextPoint=isLeftToRight?dom.nextPointUntil(dom.nextPoint(point),dom.isVisiblePoint):dom.prevPointUntil(dom.prevPoint(point),dom.isVisiblePoint);return nextPoint||point;};var endPoint=getVisiblePoint(this.getEndPoint(),false);var startPoint=this.isCollapsed()?endPoint:getVisiblePoint(this.getStartPoint(),true);return new WrappedRange(startPoint.node,startPoint.offset,endPoint.node,endPoint.offset);}; /**\n       * returns matched nodes on range\n       *\n       * @param {Function} [pred] - predicate function\n       * @param {Object} [options]\n       * @param {Boolean} [options.includeAncestor]\n       * @param {Boolean} [options.fullyContains]\n       * @return {Node[]}\n       */this.nodes=function(pred,options){pred=pred||func.ok;var includeAncestor=options&&options.includeAncestor;var fullyContains=options&&options.fullyContains; // TODO compare points and sort\nvar startPoint=this.getStartPoint();var endPoint=this.getEndPoint();var nodes=[];var leftEdgeNodes=[];dom.walkPoint(startPoint,endPoint,function(point){if(dom.isEditable(point.node)){return;}var node;if(fullyContains){if(dom.isLeftEdgePoint(point)){leftEdgeNodes.push(point.node);}if(dom.isRightEdgePoint(point)&&list.contains(leftEdgeNodes,point.node)){node=point.node;}}else if(includeAncestor){node=dom.ancestor(point.node,pred);}else {node=point.node;}if(node&&pred(node)){nodes.push(node);}},true);return list.unique(nodes);}; /**\n       * returns commonAncestor of range\n       * @return {Element} - commonAncestor\n       */this.commonAncestor=function(){return dom.commonAncestor(sc,ec);}; /**\n       * returns expanded range by pred\n       *\n       * @param {Function} pred - predicate function\n       * @return {WrappedRange}\n       */this.expand=function(pred){var startAncestor=dom.ancestor(sc,pred);var endAncestor=dom.ancestor(ec,pred);if(!startAncestor&&!endAncestor){return new WrappedRange(sc,so,ec,eo);}var boundaryPoints=this.getPoints();if(startAncestor){boundaryPoints.sc=startAncestor;boundaryPoints.so=0;}if(endAncestor){boundaryPoints.ec=endAncestor;boundaryPoints.eo=dom.nodeLength(endAncestor);}return new WrappedRange(boundaryPoints.sc,boundaryPoints.so,boundaryPoints.ec,boundaryPoints.eo);}; /**\n       * @param {Boolean} isCollapseToStart\n       * @return {WrappedRange}\n       */this.collapse=function(isCollapseToStart){if(isCollapseToStart){return new WrappedRange(sc,so,sc,so);}else {return new WrappedRange(ec,eo,ec,eo);}}; /**\n       * splitText on range\n       */this.splitText=function(){var isSameContainer=sc===ec;var boundaryPoints=this.getPoints();if(dom.isText(ec)&&!dom.isEdgePoint(this.getEndPoint())){ec.splitText(eo);}if(dom.isText(sc)&&!dom.isEdgePoint(this.getStartPoint())){boundaryPoints.sc=sc.splitText(so);boundaryPoints.so=0;if(isSameContainer){boundaryPoints.ec=boundaryPoints.sc;boundaryPoints.eo=eo-so;}}return new WrappedRange(boundaryPoints.sc,boundaryPoints.so,boundaryPoints.ec,boundaryPoints.eo);}; /**\n       * delete contents on range\n       * @return {WrappedRange}\n       */this.deleteContents=function(){if(this.isCollapsed()){return this;}var rng=this.splitText();var nodes=rng.nodes(null,{fullyContains:true}); // find new cursor point\nvar point=dom.prevPointUntil(rng.getStartPoint(),function(point){return !list.contains(nodes,point.node);});var emptyParents=[];$.each(nodes,function(idx,node){ // find empty parents\nvar parent=node.parentNode;if(point.node!==parent&&dom.nodeLength(parent)===1){emptyParents.push(parent);}dom.remove(node,false);}); // remove empty parents\n$.each(emptyParents,function(idx,node){dom.remove(node,false);});return new WrappedRange(point.node,point.offset,point.node,point.offset).normalize();}; /**\n       * makeIsOn: return isOn(pred) function\n       */var makeIsOn=function makeIsOn(pred){return function(){var ancestor=dom.ancestor(sc,pred);return !!ancestor&&ancestor===dom.ancestor(ec,pred);};}; // isOnEditable: judge whether range is on editable or not\nthis.isOnEditable=makeIsOn(dom.isEditable); // isOnList: judge whether range is on list node or not\nthis.isOnList=makeIsOn(dom.isList); // isOnAnchor: judge whether range is on anchor node or not\nthis.isOnAnchor=makeIsOn(dom.isAnchor); // isOnAnchor: judge whether range is on cell node or not\nthis.isOnCell=makeIsOn(dom.isCell); /**\n       * @param {Function} pred\n       * @return {Boolean}\n       */this.isLeftEdgeOf=function(pred){if(!dom.isLeftEdgePoint(this.getStartPoint())){return false;}var node=dom.ancestor(this.sc,pred);return node&&dom.isLeftEdgeOf(this.sc,node);}; /**\n       * returns whether range was collapsed or not\n       */this.isCollapsed=function(){return sc===ec&&so===eo;}; /**\n       * wrap inline nodes which children of body with paragraph\n       *\n       * @return {WrappedRange}\n       */this.wrapBodyInlineWithPara=function(){if(dom.isBodyContainer(sc)&&dom.isEmpty(sc)){sc.innerHTML=dom.emptyPara;return new WrappedRange(sc.firstChild,0,sc.firstChild,0);} /**\n         * [workaround] firefox often create range on not visible point. so normalize here.\n         *  - firefox: |<p>text</p>|\n         *  - chrome: <p>|text|</p>\n         */var rng=this.normalize();if(dom.isParaInline(sc)||dom.isPara(sc)){return rng;} // find inline top ancestor\nvar topAncestor;if(dom.isInline(rng.sc)){var ancestors=dom.listAncestor(rng.sc,func.not(dom.isInline));topAncestor=list.last(ancestors);if(!dom.isInline(topAncestor)){topAncestor=ancestors[ancestors.length-2]||rng.sc.childNodes[rng.so];}}else {topAncestor=rng.sc.childNodes[rng.so>0?rng.so-1:0];} // siblings not in paragraph\nvar inlineSiblings=dom.listPrev(topAncestor,dom.isParaInline).reverse();inlineSiblings=inlineSiblings.concat(dom.listNext(topAncestor.nextSibling,dom.isParaInline)); // wrap with paragraph\nif(inlineSiblings.length){var para=dom.wrap(list.head(inlineSiblings),'p');dom.appendChildNodes(para,list.tail(inlineSiblings));}return this.normalize();}; /**\n       * insert node at current cursor\n       *\n       * @param {Node} node\n       * @return {Node}\n       */this.insertNode=function(node){var rng=this.wrapBodyInlineWithPara().deleteContents();var info=dom.splitPoint(rng.getStartPoint(),dom.isInline(node));if(info.rightNode){info.rightNode.parentNode.insertBefore(node,info.rightNode);}else {info.container.appendChild(node);}return node;}; /**\n       * insert html at current cursor\n       */this.pasteHTML=function(markup){var contentsContainer=$('<div></div>').html(markup)[0];var childNodes=list.from(contentsContainer.childNodes);var rng=this.wrapBodyInlineWithPara().deleteContents();return childNodes.reverse().map(function(childNode){return rng.insertNode(childNode);}).reverse();}; /**\n       * returns text in range\n       *\n       * @return {String}\n       */this.toString=function(){var nativeRng=nativeRange();return agent.isW3CRangeSupport?nativeRng.toString():nativeRng.text;}; /**\n       * returns range for word before cursor\n       *\n       * @param {Boolean} [findAfter] - find after cursor, default: false\n       * @return {WrappedRange}\n       */this.getWordRange=function(findAfter){var endPoint=this.getEndPoint();if(!dom.isCharPoint(endPoint)){return this;}var startPoint=dom.prevPointUntil(endPoint,function(point){return !dom.isCharPoint(point);});if(findAfter){endPoint=dom.nextPointUntil(endPoint,function(point){return !dom.isCharPoint(point);});}return new WrappedRange(startPoint.node,startPoint.offset,endPoint.node,endPoint.offset);}; /**\n       * create offsetPath bookmark\n       *\n       * @param {Node} editable\n       */this.bookmark=function(editable){return {s:{path:dom.makeOffsetPath(editable,sc),offset:so},e:{path:dom.makeOffsetPath(editable,ec),offset:eo}};}; /**\n       * create offsetPath bookmark base on paragraph\n       *\n       * @param {Node[]} paras\n       */this.paraBookmark=function(paras){return {s:{path:list.tail(dom.makeOffsetPath(list.head(paras),sc)),offset:so},e:{path:list.tail(dom.makeOffsetPath(list.last(paras),ec)),offset:eo}};}; /**\n       * getClientRects\n       * @return {Rect[]}\n       */this.getClientRects=function(){var nativeRng=nativeRange();return nativeRng.getClientRects();};}; /**\n   * @class core.range\n   *\n   * Data structure\n   *  * BoundaryPoint: a point of dom tree\n   *  * BoundaryPoints: two boundaryPoints corresponding to the start and the end of the Range\n   *\n   * See to http://www.w3.org/TR/DOM-Level-2-Traversal-Range/ranges.html#Level-2-Range-Position\n   *\n   * @singleton\n   * @alternateClassName range\n   */return { /**\n       * @method\n       * \n       * create Range Object From arguments or Browser Selection\n       *\n       * @param {Node} sc - start container\n       * @param {Number} so - start offset\n       * @param {Node} ec - end container\n       * @param {Number} eo - end offset\n       * @return {WrappedRange}\n       */create:function create(sc,so,ec,eo){if(!arguments.length){ // from Browser Selection\nif(agent.isW3CRangeSupport){var selection=document.getSelection();if(!selection||selection.rangeCount===0){return null;}else if(dom.isBody(selection.anchorNode)){ // Firefox: returns entire body as range on initialization. We won't never need it.\nreturn null;}var nativeRng=selection.getRangeAt(0);sc=nativeRng.startContainer;so=nativeRng.startOffset;ec=nativeRng.endContainer;eo=nativeRng.endOffset;}else { // IE8: TextRange\nvar textRange=document.selection.createRange();var textRangeEnd=textRange.duplicate();textRangeEnd.collapse(false);var textRangeStart=textRange;textRangeStart.collapse(true);var startPoint=textRangeToPoint(textRangeStart,true),endPoint=textRangeToPoint(textRangeEnd,false); // same visible point case: range was collapsed.\nif(dom.isText(startPoint.node)&&dom.isLeftEdgePoint(startPoint)&&dom.isTextNode(endPoint.node)&&dom.isRightEdgePoint(endPoint)&&endPoint.node.nextSibling===startPoint.node){startPoint=endPoint;}sc=startPoint.cont;so=startPoint.offset;ec=endPoint.cont;eo=endPoint.offset;}}else if(arguments.length===2){ //collapsed\nec=sc;eo=so;}return new WrappedRange(sc,so,ec,eo);}, /**\n       * @method \n       * \n       * create WrappedRange from node\n       *\n       * @param {Node} node\n       * @return {WrappedRange}\n       */createFromNode:function createFromNode(node){var sc=node;var so=0;var ec=node;var eo=dom.nodeLength(ec); // browsers can't target a picture or void node\nif(dom.isVoid(sc)){so=dom.listPrev(sc).length-1;sc=sc.parentNode;}if(dom.isBR(ec)){eo=dom.listPrev(ec).length-1;ec=ec.parentNode;}else if(dom.isVoid(ec)){eo=dom.listPrev(ec).length;ec=ec.parentNode;}return this.create(sc,so,ec,eo);}, /**\n       * create WrappedRange from node after position\n       *\n       * @param {Node} node\n       * @return {WrappedRange}\n       */createFromNodeBefore:function createFromNodeBefore(node){return this.createFromNode(node).collapse(true);}, /**\n       * create WrappedRange from node after position\n       *\n       * @param {Node} node\n       * @return {WrappedRange}\n       */createFromNodeAfter:function createFromNodeAfter(node){return this.createFromNode(node).collapse();}, /**\n       * @method \n       * \n       * create WrappedRange from bookmark\n       *\n       * @param {Node} editable\n       * @param {Object} bookmark\n       * @return {WrappedRange}\n       */createFromBookmark:function createFromBookmark(editable,bookmark){var sc=dom.fromOffsetPath(editable,bookmark.s.path);var so=bookmark.s.offset;var ec=dom.fromOffsetPath(editable,bookmark.e.path);var eo=bookmark.e.offset;return new WrappedRange(sc,so,ec,eo);}, /**\n       * @method \n       *\n       * create WrappedRange from paraBookmark\n       *\n       * @param {Object} bookmark\n       * @param {Node[]} paras\n       * @return {WrappedRange}\n       */createFromParaBookmark:function createFromParaBookmark(bookmark,paras){var so=bookmark.s.offset;var eo=bookmark.e.offset;var sc=dom.fromOffsetPath(list.head(paras),bookmark.s.path);var ec=dom.fromOffsetPath(list.last(paras),bookmark.e.path);return new WrappedRange(sc,so,ec,eo);}};}(); /**\n   * @class defaults \n   * \n   * @singleton\n   */var defaults={ /** @property */version:'0.6.16', /**\n     * \n     * for event options, reference to EventHandler.attach\n     * \n     * @property {Object} options \n     * @property {String/Number} [options.width=null] set editor width \n     * @property {String/Number} [options.height=null] set editor height, ex) 300\n     * @property {String/Number} options.minHeight set minimum height of editor\n     * @property {String/Number} options.maxHeight\n     * @property {String/Number} options.focus \n     * @property {Number} options.tabsize \n     * @property {Boolean} options.styleWithSpan\n     * @property {Object} options.codemirror\n     * @property {Object} [options.codemirror.mode='text/html']\n     * @property {Object} [options.codemirror.htmlMode=true]\n     * @property {Object} [options.codemirror.lineNumbers=true]\n     * @property {String} [options.lang=en-US] language 'en-US', 'ko-KR', ...\n     * @property {String} [options.direction=null] text direction, ex) 'rtl'\n     * @property {Array} [options.toolbar]\n     * @property {Boolean} [options.airMode=false]\n     * @property {Array} [options.airPopover]\n     * @property {Fucntion} [options.onInit] initialize\n     * @property {Fucntion} [options.onsubmit]\n     */options:{width:null, // set editor width\nheight:null, // set editor height, ex) 300\nminHeight:null, // set minimum height of editor\nmaxHeight:null, // set maximum height of editor\nfocus:false, // set focus to editable area after initializing summernote\ntabsize:4, // size of tab ex) 2 or 4\nstyleWithSpan:true, // style with span (Chrome and FF only)\ndisableLinkTarget:false, // hide link Target Checkbox\ndisableDragAndDrop:false, // disable drag and drop event\ndisableResizeEditor:false, // disable resizing editor\ndisableResizeImage:false, // disable resizing image\nshortcuts:true, // enable keyboard shortcuts\ntextareaAutoSync:true, // enable textarea auto sync\nplaceholder:false, // enable placeholder text\nprettifyHtml:true, // enable prettifying html while toggling codeview\niconPrefix:'fa fa-', // prefix for css icon classes\nicons:{font:{bold:'bold',italic:'italic',underline:'underline',clear:'eraser',height:'text-height',strikethrough:'strikethrough',superscript:'superscript',subscript:'subscript'},image:{image:'picture-o',floatLeft:'align-left',floatRight:'align-right',floatNone:'align-justify',shapeRounded:'square',shapeCircle:'circle-o',shapeThumbnail:'picture-o',shapeNone:'times',remove:'trash-o'},link:{link:'link',unlink:'unlink',edit:'edit'},table:{table:'table'},hr:{insert:'minus'},style:{style:'magic'},lists:{unordered:'list-ul',ordered:'list-ol'},options:{help:'question',fullscreen:'arrows-alt',codeview:'code'},paragraph:{paragraph:'align-left',outdent:'outdent',indent:'indent',left:'align-left',center:'align-center',right:'align-right',justify:'align-justify'},color:{recent:'font'},history:{undo:'undo',redo:'repeat'},misc:{check:'check'}},dialogsInBody:false, // false will add dialogs into editor\ncodemirror:{ // codemirror options\nmode:'text/html',htmlMode:true,lineNumbers:true}, // language\nlang:'en-US', // language 'en-US', 'ko-KR', ...\ndirection:null, // text direction, ex) 'rtl'\n// toolbar\ntoolbar:[['style',['style']],['font',['bold','italic','underline','clear']], // ['font', ['bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'clear']],\n['fontname',['fontname']],['fontsize',['fontsize']],['color',['color']],['para',['ul','ol','paragraph']],['height',['height']],['table',['table']],['insert',['link','picture','hr']],['view',['fullscreen','codeview']],['help',['help']]],plugin:{}, // air mode: inline editor\nairMode:false, // airPopover: [\n//   ['style', ['style']],\n//   ['font', ['bold', 'italic', 'underline', 'clear']],\n//   ['fontname', ['fontname']],\n//   ['color', ['color']],\n//   ['para', ['ul', 'ol', 'paragraph']],\n//   ['height', ['height']],\n//   ['table', ['table']],\n//   ['insert', ['link', 'picture']],\n//   ['help', ['help']]\n// ],\nairPopover:[['color',['color']],['font',['bold','underline','clear']],['para',['ul','paragraph']],['table',['table']],['insert',['link','picture']]], // style tag\nstyleTags:['p','blockquote','pre','h1','h2','h3','h4','h5','h6'], // default fontName\ndefaultFontName:'Helvetica Neue', // fontName\nfontNames:['Arial','Arial Black','Comic Sans MS','Courier New','Helvetica Neue','Helvetica','Impact','Lucida Grande','Tahoma','Times New Roman','Verdana'],fontNamesIgnoreCheck:[],fontSizes:['8','9','10','11','12','14','18','24','36'], // pallete colors(n x n)\ncolors:[['#000000','#424242','#636363','#9C9C94','#CEC6CE','#EFEFEF','#F7F7F7','#FFFFFF'],['#FF0000','#FF9C00','#FFFF00','#00FF00','#00FFFF','#0000FF','#9C00FF','#FF00FF'],['#F7C6CE','#FFE7CE','#FFEFC6','#D6EFD6','#CEDEE7','#CEE7F7','#D6D6E7','#E7D6DE'],['#E79C9C','#FFC69C','#FFE79C','#B5D6A5','#A5C6CE','#9CC6EF','#B5A5D6','#D6A5BD'],['#E76363','#F7AD6B','#FFD663','#94BD7B','#73A5AD','#6BADDE','#8C7BC6','#C67BA5'],['#CE0000','#E79439','#EFC631','#6BA54A','#4A7B8C','#3984C6','#634AA5','#A54A7B'],['#9C0000','#B56308','#BD9400','#397B21','#104A5A','#085294','#311873','#731842'],['#630000','#7B3900','#846300','#295218','#083139','#003163','#21104A','#4A1031']], // lineHeight\nlineHeights:['1.0','1.2','1.4','1.5','1.6','1.8','2.0','3.0'], // insertTable max size\ninsertTableMaxSize:{col:10,row:10}, // image\nmaximumImageFileSize:null, // size in bytes, null = no limit\n// callbacks\noninit:null, // initialize\nonfocus:null, // editable has focus\nonblur:null, // editable out of focus\nonenter:null, // enter key pressed\nonkeyup:null, // keyup\nonkeydown:null, // keydown\nonImageUpload:null, // imageUpload\nonImageUploadError:null, // imageUploadError\nonMediaDelete:null, // media delete\nonToolbarClick:null,onsubmit:null, /**\n       * manipulate link address when user create link\n       * @param {String} sLinkUrl\n       * @return {String}\n       */onCreateLink:function onCreateLink(sLinkUrl){if(sLinkUrl.indexOf('@')!==-1&&sLinkUrl.indexOf(':')===-1){sLinkUrl='mailto:'+sLinkUrl;}return sLinkUrl;},keyMap:{pc:{'ENTER':'insertParagraph','CTRL+Z':'undo','CTRL+Y':'redo','TAB':'tab','SHIFT+TAB':'untab','CTRL+B':'bold','CTRL+I':'italic','CTRL+U':'underline','CTRL+SHIFT+S':'strikethrough','CTRL+BACKSLASH':'removeFormat','CTRL+SHIFT+L':'justifyLeft','CTRL+SHIFT+E':'justifyCenter','CTRL+SHIFT+R':'justifyRight','CTRL+SHIFT+J':'justifyFull','CTRL+SHIFT+NUM7':'insertUnorderedList','CTRL+SHIFT+NUM8':'insertOrderedList','CTRL+LEFTBRACKET':'outdent','CTRL+RIGHTBRACKET':'indent','CTRL+NUM0':'formatPara','CTRL+NUM1':'formatH1','CTRL+NUM2':'formatH2','CTRL+NUM3':'formatH3','CTRL+NUM4':'formatH4','CTRL+NUM5':'formatH5','CTRL+NUM6':'formatH6','CTRL+ENTER':'insertHorizontalRule','CTRL+K':'showLinkDialog'},mac:{'ENTER':'insertParagraph','CMD+Z':'undo','CMD+SHIFT+Z':'redo','TAB':'tab','SHIFT+TAB':'untab','CMD+B':'bold','CMD+I':'italic','CMD+U':'underline','CMD+SHIFT+S':'strikethrough','CMD+BACKSLASH':'removeFormat','CMD+SHIFT+L':'justifyLeft','CMD+SHIFT+E':'justifyCenter','CMD+SHIFT+R':'justifyRight','CMD+SHIFT+J':'justifyFull','CMD+SHIFT+NUM7':'insertUnorderedList','CMD+SHIFT+NUM8':'insertOrderedList','CMD+LEFTBRACKET':'outdent','CMD+RIGHTBRACKET':'indent','CMD+NUM0':'formatPara','CMD+NUM1':'formatH1','CMD+NUM2':'formatH2','CMD+NUM3':'formatH3','CMD+NUM4':'formatH4','CMD+NUM5':'formatH5','CMD+NUM6':'formatH6','CMD+ENTER':'insertHorizontalRule','CMD+K':'showLinkDialog'}}}, // default language: en-US\nlang:{'en-US':{font:{bold:'Bold',italic:'Italic',underline:'Underline',clear:'Remove Font Style',height:'Line Height',name:'Font Family',strikethrough:'Strikethrough',subscript:'Subscript',superscript:'Superscript',size:'Font Size'},image:{image:'Picture',insert:'Insert Image',resizeFull:'Resize Full',resizeHalf:'Resize Half',resizeQuarter:'Resize Quarter',floatLeft:'Float Left',floatRight:'Float Right',floatNone:'Float None',shapeRounded:'Shape: Rounded',shapeCircle:'Shape: Circle',shapeThumbnail:'Shape: Thumbnail',shapeNone:'Shape: None',dragImageHere:'Drag image or text here',dropImage:'Drop image or Text',selectFromFiles:'Select from files',maximumFileSize:'Maximum file size',maximumFileSizeError:'Maximum file size exceeded.',url:'Image URL',remove:'Remove Image'},link:{link:'Link',insert:'Insert Link',unlink:'Unlink',edit:'Edit',textToDisplay:'Text to display',url:'To what URL should this link go?',openInNewWindow:'Open in new window'},table:{table:'Table'},hr:{insert:'Insert Horizontal Rule'},style:{style:'Style',normal:'Normal',blockquote:'Quote',pre:'Code',h1:'Header 1',h2:'Header 2',h3:'Header 3',h4:'Header 4',h5:'Header 5',h6:'Header 6'},lists:{unordered:'Unordered list',ordered:'Ordered list'},options:{help:'Help',fullscreen:'Full Screen',codeview:'Code View'},paragraph:{paragraph:'Paragraph',outdent:'Outdent',indent:'Indent',left:'Align left',center:'Align center',right:'Align right',justify:'Justify full'},color:{recent:'Recent Color',more:'More Color',background:'Background Color',foreground:'Foreground Color',transparent:'Transparent',setTransparent:'Set transparent',reset:'Reset',resetToDefault:'Reset to default'},shortcut:{shortcuts:'Keyboard shortcuts',close:'Close',textFormatting:'Text formatting',action:'Action',paragraphFormatting:'Paragraph formatting',documentStyle:'Document Style',extraKeys:'Extra keys'},history:{undo:'Undo',redo:'Redo'}}}}; /**\n   * @class core.async\n   *\n   * Async functions which returns `Promise`\n   *\n   * @singleton\n   * @alternateClassName async\n   */var async=function(){ /**\n     * @method readFileAsDataURL\n     *\n     * read contents of file as representing URL\n     *\n     * @param {File} file\n     * @return {Promise} - then: sDataUrl\n     */var readFileAsDataURL=function readFileAsDataURL(file){return $.Deferred(function(deferred){$.extend(new FileReader(),{onload:function onload(e){var sDataURL=e.target.result;deferred.resolve(sDataURL);},onerror:function onerror(){deferred.reject(this);}}).readAsDataURL(file);}).promise();}; /**\n     * @method createImage\n     *\n     * create `<image>` from url string\n     *\n     * @param {String} sUrl\n     * @param {String} filename\n     * @return {Promise} - then: $image\n     */var createImage=function createImage(sUrl,filename){return $.Deferred(function(deferred){var $img=$('<img>');$img.one('load',function(){$img.off('error abort');deferred.resolve($img);}).one('error abort',function(){$img.off('load').detach();deferred.reject($img);}).css({display:'none'}).appendTo(document.body).attr({'src':sUrl,'data-filename':filename});}).promise();};return {readFileAsDataURL:readFileAsDataURL,createImage:createImage};}(); /**\n   * @class core.key\n   *\n   * Object for keycodes.\n   *\n   * @singleton\n   * @alternateClassName key\n   */var key=function(){var keyMap={'BACKSPACE':8,'TAB':9,'ENTER':13,'SPACE':32, // Number: 0-9\n'NUM0':48,'NUM1':49,'NUM2':50,'NUM3':51,'NUM4':52,'NUM5':53,'NUM6':54,'NUM7':55,'NUM8':56, // Alphabet: a-z\n'B':66,'E':69,'I':73,'J':74,'K':75,'L':76,'R':82,'S':83,'U':85,'V':86,'Y':89,'Z':90,'SLASH':191,'LEFTBRACKET':219,'BACKSLASH':220,'RIGHTBRACKET':221};return { /**\n       * @method isEdit\n       *\n       * @param {Number} keyCode\n       * @return {Boolean}\n       */isEdit:function isEdit(keyCode){return list.contains([8,9,13,32],keyCode);}, /**\n       * @method isMove\n       *\n       * @param {Number} keyCode\n       * @return {Boolean}\n       */isMove:function isMove(keyCode){return list.contains([37,38,39,40],keyCode);}, /**\n       * @property {Object} nameFromCode\n       * @property {String} nameFromCode.8 \"BACKSPACE\"\n       */nameFromCode:func.invertObject(keyMap),code:keyMap};}(); /**\n   * @class editing.History\n   *\n   * Editor History\n   *\n   */var History=function History($editable){var stack=[],stackOffset=-1;var editable=$editable[0];var makeSnapshot=function makeSnapshot(){var rng=range.create();var emptyBookmark={s:{path:[],offset:0},e:{path:[],offset:0}};return {contents:$editable.html(),bookmark:rng?rng.bookmark(editable):emptyBookmark};};var applySnapshot=function applySnapshot(snapshot){if(snapshot.contents!==null){$editable.html(snapshot.contents);}if(snapshot.bookmark!==null){range.createFromBookmark(editable,snapshot.bookmark).select();}}; /**\n     * undo\n     */this.undo=function(){ // Create snap shot if not yet recorded\nif($editable.html()!==stack[stackOffset].contents){this.recordUndo();}if(0<stackOffset){stackOffset--;applySnapshot(stack[stackOffset]);}}; /**\n     * redo\n     */this.redo=function(){if(stack.length-1>stackOffset){stackOffset++;applySnapshot(stack[stackOffset]);}}; /**\n     * recorded undo\n     */this.recordUndo=function(){stackOffset++; // Wash out stack after stackOffset\nif(stack.length>stackOffset){stack=stack.slice(0,stackOffset);} // Create new snapshot and push it to the end\nstack.push(makeSnapshot());}; // Create first undo stack\nthis.recordUndo();}; /**\n   * @class editing.Style\n   *\n   * Style\n   *\n   */var Style=function Style(){ /**\n     * @method jQueryCSS\n     *\n     * [workaround] for old jQuery\n     * passing an array of style properties to .css()\n     * will result in an object of property-value pairs.\n     * (compability with version < 1.9)\n     *\n     * @private\n     * @param  {jQuery} $obj\n     * @param  {Array} propertyNames - An array of one or more CSS properties.\n     * @return {Object}\n     */var jQueryCSS=function jQueryCSS($obj,propertyNames){if(agent.jqueryVersion<1.9){var result={};$.each(propertyNames,function(idx,propertyName){result[propertyName]=$obj.css(propertyName);});return result;}return $obj.css.call($obj,propertyNames);}; /**\n     * returns style object from node\n     *\n     * @param {jQuery} $node\n     * @return {Object}\n     */this.fromNode=function($node){var properties=['font-family','font-size','text-align','list-style-type','line-height'];var styleInfo=jQueryCSS($node,properties)||{};styleInfo['font-size']=parseInt(styleInfo['font-size'],10);return styleInfo;}; /**\n     * paragraph level style\n     *\n     * @param {WrappedRange} rng\n     * @param {Object} styleInfo\n     */this.stylePara=function(rng,styleInfo){$.each(rng.nodes(dom.isPara,{includeAncestor:true}),function(idx,para){$(para).css(styleInfo);});}; /**\n     * insert and returns styleNodes on range.\n     *\n     * @param {WrappedRange} rng\n     * @param {Object} [options] - options for styleNodes\n     * @param {String} [options.nodeName] - default: `SPAN`\n     * @param {Boolean} [options.expandClosestSibling] - default: `false`\n     * @param {Boolean} [options.onlyPartialContains] - default: `false`\n     * @return {Node[]}\n     */this.styleNodes=function(rng,options){rng=rng.splitText();var nodeName=options&&options.nodeName||'SPAN';var expandClosestSibling=!!(options&&options.expandClosestSibling);var onlyPartialContains=!!(options&&options.onlyPartialContains);if(rng.isCollapsed()){return [rng.insertNode(dom.create(nodeName))];}var pred=dom.makePredByNodeName(nodeName);var nodes=rng.nodes(dom.isText,{fullyContains:true}).map(function(text){return dom.singleChildAncestor(text,pred)||dom.wrap(text,nodeName);});if(expandClosestSibling){if(onlyPartialContains){var nodesInRange=rng.nodes(); // compose with partial contains predication\npred=func.and(pred,function(node){return list.contains(nodesInRange,node);});}return nodes.map(function(node){var siblings=dom.withClosestSiblings(node,pred);var head=list.head(siblings);var tails=list.tail(siblings);$.each(tails,function(idx,elem){dom.appendChildNodes(head,elem.childNodes);dom.remove(elem);});return list.head(siblings);});}else {return nodes;}}; /**\n     * get current style on cursor\n     *\n     * @param {WrappedRange} rng\n     * @return {Object} - object contains style properties.\n     */this.current=function(rng){var $cont=$(dom.isText(rng.sc)?rng.sc.parentNode:rng.sc);var styleInfo=this.fromNode($cont); // document.queryCommandState for toggle state\nstyleInfo['font-bold']=document.queryCommandState('bold')?'bold':'normal';styleInfo['font-italic']=document.queryCommandState('italic')?'italic':'normal';styleInfo['font-underline']=document.queryCommandState('underline')?'underline':'normal';styleInfo['font-strikethrough']=document.queryCommandState('strikeThrough')?'strikethrough':'normal';styleInfo['font-superscript']=document.queryCommandState('superscript')?'superscript':'normal';styleInfo['font-subscript']=document.queryCommandState('subscript')?'subscript':'normal'; // list-style-type to list-style(unordered, ordered)\nif(!rng.isOnList()){styleInfo['list-style']='none';}else {var aOrderedType=['circle','disc','disc-leading-zero','square'];var isUnordered=$.inArray(styleInfo['list-style-type'],aOrderedType)>-1;styleInfo['list-style']=isUnordered?'unordered':'ordered';}var para=dom.ancestor(rng.sc,dom.isPara);if(para&&para.style['line-height']){styleInfo['line-height']=para.style.lineHeight;}else {var lineHeight=parseInt(styleInfo['line-height'],10)/parseInt(styleInfo['font-size'],10);styleInfo['line-height']=lineHeight.toFixed(1);}styleInfo.anchor=rng.isOnAnchor()&&dom.ancestor(rng.sc,dom.isAnchor);styleInfo.ancestors=dom.listAncestor(rng.sc,dom.isEditable);styleInfo.range=rng;return styleInfo;};}; /**\n   * @class editing.Bullet\n   *\n   * @alternateClassName Bullet\n   */var Bullet=function Bullet(){ /**\n     * @method insertOrderedList\n     *\n     * toggle ordered list\n     *\n     * @type command\n     */this.insertOrderedList=function(){this.toggleList('OL');}; /**\n     * @method insertUnorderedList\n     *\n     * toggle unordered list\n     *\n     * @type command\n     */this.insertUnorderedList=function(){this.toggleList('UL');}; /**\n     * @method indent\n     *\n     * indent\n     *\n     * @type command\n     */this.indent=function(){var self=this;var rng=range.create().wrapBodyInlineWithPara();var paras=rng.nodes(dom.isPara,{includeAncestor:true});var clustereds=list.clusterBy(paras,func.peq2('parentNode'));$.each(clustereds,function(idx,paras){var head=list.head(paras);if(dom.isLi(head)){self.wrapList(paras,head.parentNode.nodeName);}else {$.each(paras,function(idx,para){$(para).css('marginLeft',function(idx,val){return (parseInt(val,10)||0)+25;});});}});rng.select();}; /**\n     * @method outdent\n     *\n     * outdent\n     *\n     * @type command\n     */this.outdent=function(){var self=this;var rng=range.create().wrapBodyInlineWithPara();var paras=rng.nodes(dom.isPara,{includeAncestor:true});var clustereds=list.clusterBy(paras,func.peq2('parentNode'));$.each(clustereds,function(idx,paras){var head=list.head(paras);if(dom.isLi(head)){self.releaseList([paras]);}else {$.each(paras,function(idx,para){$(para).css('marginLeft',function(idx,val){val=parseInt(val,10)||0;return val>25?val-25:'';});});}});rng.select();}; /**\n     * @method toggleList\n     *\n     * toggle list\n     *\n     * @param {String} listName - OL or UL\n     */this.toggleList=function(listName){var self=this;var rng=range.create().wrapBodyInlineWithPara();var paras=rng.nodes(dom.isPara,{includeAncestor:true});var bookmark=rng.paraBookmark(paras);var clustereds=list.clusterBy(paras,func.peq2('parentNode')); // paragraph to list\nif(list.find(paras,dom.isPurePara)){var wrappedParas=[];$.each(clustereds,function(idx,paras){wrappedParas=wrappedParas.concat(self.wrapList(paras,listName));});paras=wrappedParas; // list to paragraph or change list style\n}else {var diffLists=rng.nodes(dom.isList,{includeAncestor:true}).filter(function(listNode){return !$.nodeName(listNode,listName);});if(diffLists.length){$.each(diffLists,function(idx,listNode){dom.replace(listNode,listName);});}else {paras=this.releaseList(clustereds,true);}}range.createFromParaBookmark(bookmark,paras).select();}; /**\n     * @method wrapList\n     *\n     * @param {Node[]} paras\n     * @param {String} listName\n     * @return {Node[]}\n     */this.wrapList=function(paras,listName){var head=list.head(paras);var last=list.last(paras);var prevList=dom.isList(head.previousSibling)&&head.previousSibling;var nextList=dom.isList(last.nextSibling)&&last.nextSibling;var listNode=prevList||dom.insertAfter(dom.create(listName||'UL'),last); // P to LI\nparas=paras.map(function(para){return dom.isPurePara(para)?dom.replace(para,'LI'):para;}); // append to list(<ul>, <ol>)\ndom.appendChildNodes(listNode,paras);if(nextList){dom.appendChildNodes(listNode,list.from(nextList.childNodes));dom.remove(nextList);}return paras;}; /**\n     * @method releaseList\n     *\n     * @param {Array[]} clustereds\n     * @param {Boolean} isEscapseToBody\n     * @return {Node[]}\n     */this.releaseList=function(clustereds,isEscapseToBody){var releasedParas=[];$.each(clustereds,function(idx,paras){var head=list.head(paras);var last=list.last(paras);var headList=isEscapseToBody?dom.lastAncestor(head,dom.isList):head.parentNode;var lastList=headList.childNodes.length>1?dom.splitTree(headList,{node:last.parentNode,offset:dom.position(last)+1},{isSkipPaddingBlankHTML:true}):null;var middleList=dom.splitTree(headList,{node:head.parentNode,offset:dom.position(head)},{isSkipPaddingBlankHTML:true});paras=isEscapseToBody?dom.listDescendant(middleList,dom.isLi):list.from(middleList.childNodes).filter(dom.isLi); // LI to P\nif(isEscapseToBody||!dom.isList(headList.parentNode)){paras=paras.map(function(para){return dom.replace(para,'P');});}$.each(list.from(paras).reverse(),function(idx,para){dom.insertAfter(para,headList);}); // remove empty lists\nvar rootLists=list.compact([headList,middleList,lastList]);$.each(rootLists,function(idx,rootList){var listNodes=[rootList].concat(dom.listDescendant(rootList,dom.isList));$.each(listNodes.reverse(),function(idx,listNode){if(!dom.nodeLength(listNode)){dom.remove(listNode,true);}});});releasedParas=releasedParas.concat(paras);});return releasedParas;};}; /**\n   * @class editing.Typing\n   *\n   * Typing\n   *\n   */var Typing=function Typing(){ // a Bullet instance to toggle lists off\nvar bullet=new Bullet(); /**\n     * insert tab\n     *\n     * @param {jQuery} $editable\n     * @param {WrappedRange} rng\n     * @param {Number} tabsize\n     */this.insertTab=function($editable,rng,tabsize){var tab=dom.createText(new Array(tabsize+1).join(dom.NBSP_CHAR));rng=rng.deleteContents();rng.insertNode(tab,true);rng=range.create(tab,tabsize);rng.select();}; /**\n     * insert paragraph\n     */this.insertParagraph=function(){var rng=range.create(); // deleteContents on range.\nrng=rng.deleteContents(); // Wrap range if it needs to be wrapped by paragraph\nrng=rng.wrapBodyInlineWithPara(); // finding paragraph\nvar splitRoot=dom.ancestor(rng.sc,dom.isPara);var nextPara; // on paragraph: split paragraph\nif(splitRoot){ // if it is an empty line with li\nif(dom.isEmpty(splitRoot)&&dom.isLi(splitRoot)){ // disable UL/OL and escape!\nbullet.toggleList(splitRoot.parentNode.nodeName);return; // if new line has content (not a line break)\n}else {nextPara=dom.splitTree(splitRoot,rng.getStartPoint());var emptyAnchors=dom.listDescendant(splitRoot,dom.isEmptyAnchor);emptyAnchors=emptyAnchors.concat(dom.listDescendant(nextPara,dom.isEmptyAnchor));$.each(emptyAnchors,function(idx,anchor){dom.remove(anchor);});} // no paragraph: insert empty paragraph\n}else {var next=rng.sc.childNodes[rng.so];nextPara=$(dom.emptyPara)[0];if(next){rng.sc.insertBefore(nextPara,next);}else {rng.sc.appendChild(nextPara);}}range.create(nextPara,0).normalize().select();};}; /**\n   * @class editing.Table\n   *\n   * Table\n   *\n   */var Table=function Table(){ /**\n     * handle tab key\n     *\n     * @param {WrappedRange} rng\n     * @param {Boolean} isShift\n     */this.tab=function(rng,isShift){var cell=dom.ancestor(rng.commonAncestor(),dom.isCell);var table=dom.ancestor(cell,dom.isTable);var cells=dom.listDescendant(table,dom.isCell);var nextCell=list[isShift?'prev':'next'](cells,cell);if(nextCell){range.create(nextCell,0).select();}}; /**\n     * create empty table element\n     *\n     * @param {Number} rowCount\n     * @param {Number} colCount\n     * @return {Node}\n     */this.createTable=function(colCount,rowCount){var tds=[],tdHTML;for(var idxCol=0;idxCol<colCount;idxCol++){tds.push('<td>'+dom.blank+'</td>');}tdHTML=tds.join('');var trs=[],trHTML;for(var idxRow=0;idxRow<rowCount;idxRow++){trs.push('<tr>'+tdHTML+'</tr>');}trHTML=trs.join('');return $('<table class=\"table table-bordered\">'+trHTML+'</table>')[0];};};var KEY_BOGUS='bogus'; /**\n   * @class editing.Editor\n   *\n   * Editor\n   *\n   */var Editor=function Editor(handler){var self=this;var style=new Style();var table=new Table();var typing=new Typing();var bullet=new Bullet(); /**\n     * @method createRange\n     *\n     * create range\n     *\n     * @param {jQuery} $editable\n     * @return {WrappedRange}\n     */this.createRange=function($editable){this.focus($editable);return range.create();}; /**\n     * @method saveRange\n     *\n     * save current range\n     *\n     * @param {jQuery} $editable\n     * @param {Boolean} [thenCollapse=false]\n     */this.saveRange=function($editable,thenCollapse){this.focus($editable);$editable.data('range',range.create());if(thenCollapse){range.create().collapse().select();}}; /**\n     * @method saveRange\n     *\n     * save current node list to $editable.data('childNodes')\n     *\n     * @param {jQuery} $editable\n     */this.saveNode=function($editable){ // copy child node reference\nvar copy=[];for(var key=0,len=$editable[0].childNodes.length;key<len;key++){copy.push($editable[0].childNodes[key]);}$editable.data('childNodes',copy);}; /**\n     * @method restoreRange\n     *\n     * restore lately range\n     *\n     * @param {jQuery} $editable\n     */this.restoreRange=function($editable){var rng=$editable.data('range');if(rng){rng.select();this.focus($editable);}}; /**\n     * @method restoreNode\n     *\n     * restore lately node list\n     *\n     * @param {jQuery} $editable\n     */this.restoreNode=function($editable){$editable.html('');var child=$editable.data('childNodes');for(var index=0,len=child.length;index<len;index++){$editable[0].appendChild(child[index]);}}; /**\n     * @method currentStyle\n     *\n     * current style\n     *\n     * @param {Node} target\n     * @return {Object|Boolean} unfocus\n     */this.currentStyle=function(target){var rng=range.create();var styleInfo=rng&&rng.isOnEditable()?style.current(rng.normalize()):{};if(dom.isImg(target)){styleInfo.image=target;}return styleInfo;}; /**\n     * style from node\n     *\n     * @param {jQuery} $node\n     * @return {Object}\n     */this.styleFromNode=function($node){return style.fromNode($node);};var triggerOnBeforeChange=function triggerOnBeforeChange($editable){var $holder=dom.makeLayoutInfo($editable).holder();handler.bindCustomEvent($holder,$editable.data('callbacks'),'before.command')($editable.html(),$editable);};var triggerOnChange=function triggerOnChange($editable){var $holder=dom.makeLayoutInfo($editable).holder();handler.bindCustomEvent($holder,$editable.data('callbacks'),'change')($editable.html(),$editable);}; /**\n     * @method undo\n     * undo\n     * @param {jQuery} $editable\n     */this.undo=function($editable){triggerOnBeforeChange($editable);$editable.data('NoteHistory').undo();triggerOnChange($editable);}; /**\n     * @method redo\n     * redo\n     * @param {jQuery} $editable\n     */this.redo=function($editable){triggerOnBeforeChange($editable);$editable.data('NoteHistory').redo();triggerOnChange($editable);}; /**\n     * @method beforeCommand\n     * before command\n     * @param {jQuery} $editable\n     */var beforeCommand=this.beforeCommand=function($editable){triggerOnBeforeChange($editable); // keep focus on editable before command execution\nself.focus($editable);}; /**\n     * @method afterCommand\n     * after command\n     * @param {jQuery} $editable\n     * @param {Boolean} isPreventTrigger\n     */var afterCommand=this.afterCommand=function($editable,isPreventTrigger){$editable.data('NoteHistory').recordUndo();if(!isPreventTrigger){triggerOnChange($editable);}}; /**\n     * @method bold\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /**\n     * @method italic\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /**\n     * @method underline\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /**\n     * @method strikethrough\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /**\n     * @method formatBlock\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /**\n     * @method superscript\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /**\n     * @method subscript\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /**\n     * @method justifyLeft\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /**\n     * @method justifyCenter\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /**\n     * @method justifyRight\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /**\n     * @method justifyFull\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /**\n     * @method formatBlock\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /**\n     * @method removeFormat\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /**\n     * @method backColor\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /**\n     * @method foreColor\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /**\n     * @method insertHorizontalRule\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /**\n     * @method fontName\n     *\n     * change font name\n     *\n     * @param {jQuery} $editable\n     * @param {Mixed} value\n     */ /* jshint ignore:start */ // native commands(with execCommand), generate function for execCommand\nvar commands=['bold','italic','underline','strikethrough','superscript','subscript','justifyLeft','justifyCenter','justifyRight','justifyFull','formatBlock','removeFormat','backColor','foreColor','fontName'];for(var idx=0,len=commands.length;idx<len;idx++){this[commands[idx]]=function(sCmd){return function($editable,value){beforeCommand($editable);document.execCommand(sCmd,false,value);afterCommand($editable,true);};}(commands[idx]);} /* jshint ignore:end */ /**\n     * @method tab\n     *\n     * handle tab key\n     *\n     * @param {jQuery} $editable\n     * @param {Object} options\n     */this.tab=function($editable,options){var rng=this.createRange($editable);if(rng.isCollapsed()&&rng.isOnCell()){table.tab(rng);}else {beforeCommand($editable);typing.insertTab($editable,rng,options.tabsize);afterCommand($editable);}}; /**\n     * @method untab\n     *\n     * handle shift+tab key\n     *\n     */this.untab=function($editable){var rng=this.createRange($editable);if(rng.isCollapsed()&&rng.isOnCell()){table.tab(rng,true);}}; /**\n     * @method insertParagraph\n     *\n     * insert paragraph\n     *\n     * @param {Node} $editable\n     */this.insertParagraph=function($editable){beforeCommand($editable);typing.insertParagraph($editable);afterCommand($editable);}; /**\n     * @method insertOrderedList\n     *\n     * @param {jQuery} $editable\n     */this.insertOrderedList=function($editable){beforeCommand($editable);bullet.insertOrderedList($editable);afterCommand($editable);}; /**\n     * @param {jQuery} $editable\n     */this.insertUnorderedList=function($editable){beforeCommand($editable);bullet.insertUnorderedList($editable);afterCommand($editable);}; /**\n     * @param {jQuery} $editable\n     */this.indent=function($editable){beforeCommand($editable);bullet.indent($editable);afterCommand($editable);}; /**\n     * @param {jQuery} $editable\n     */this.outdent=function($editable){beforeCommand($editable);bullet.outdent($editable);afterCommand($editable);}; /**\n     * insert image\n     *\n     * @param {jQuery} $editable\n     * @param {String} sUrl\n     */this.insertImage=function($editable,sUrl,filename){async.createImage(sUrl,filename).then(function($image){beforeCommand($editable);$image.css({display:'',width:Math.min($editable.width(),$image.width())});range.create().insertNode($image[0]);range.createFromNodeAfter($image[0]).select();afterCommand($editable);}).fail(function(){var $holder=dom.makeLayoutInfo($editable).holder();handler.bindCustomEvent($holder,$editable.data('callbacks'),'image.upload.error')();});}; /**\n     * @method insertNode\n     * insert node\n     * @param {Node} $editable\n     * @param {Node} node\n     */this.insertNode=function($editable,node){beforeCommand($editable);range.create().insertNode(node);range.createFromNodeAfter(node).select();afterCommand($editable);}; /**\n     * insert text\n     * @param {Node} $editable\n     * @param {String} text\n     */this.insertText=function($editable,text){beforeCommand($editable);var textNode=range.create().insertNode(dom.createText(text));range.create(textNode,dom.nodeLength(textNode)).select();afterCommand($editable);}; /**\n     * paste HTML\n     * @param {Node} $editable\n     * @param {String} markup\n     */this.pasteHTML=function($editable,markup){beforeCommand($editable);var contents=range.create().pasteHTML(markup);range.createFromNodeAfter(list.last(contents)).select();afterCommand($editable);}; /**\n     * formatBlock\n     *\n     * @param {jQuery} $editable\n     * @param {String} tagName\n     */this.formatBlock=function($editable,tagName){beforeCommand($editable); // [workaround] for MSIE, IE need `<`\ntagName=agent.isMSIE?'<'+tagName+'>':tagName;document.execCommand('FormatBlock',false,tagName);afterCommand($editable);};this.formatPara=function($editable){beforeCommand($editable);this.formatBlock($editable,'P');afterCommand($editable);}; /* jshint ignore:start */for(var idx=1;idx<=6;idx++){this['formatH'+idx]=function(idx){return function($editable){this.formatBlock($editable,'H'+idx);};}(idx);}; /* jshint ignore:end */ /**\n     * fontSize\n     *\n     * @param {jQuery} $editable\n     * @param {String} value - px\n     */this.fontSize=function($editable,value){var rng=range.create();if(rng.isCollapsed()){var spans=style.styleNodes(rng);var firstSpan=list.head(spans);$(spans).css({'font-size':value+'px'}); // [workaround] added styled bogus span for style\n//  - also bogus character needed for cursor position\nif(firstSpan&&!dom.nodeLength(firstSpan)){firstSpan.innerHTML=dom.ZERO_WIDTH_NBSP_CHAR;range.createFromNodeAfter(firstSpan.firstChild).select();$editable.data(KEY_BOGUS,firstSpan);}}else {beforeCommand($editable);$(style.styleNodes(rng)).css({'font-size':value+'px'});afterCommand($editable);}}; /**\n     * insert horizontal rule\n     * @param {jQuery} $editable\n     */this.insertHorizontalRule=function($editable){beforeCommand($editable);var rng=range.create();var hrNode=rng.insertNode($('<HR/>')[0]);if(hrNode.nextSibling){range.create(hrNode.nextSibling,0).normalize().select();}afterCommand($editable);}; /**\n     * remove bogus node and character\n     */this.removeBogus=function($editable){var bogusNode=$editable.data(KEY_BOGUS);if(!bogusNode){return;}var textNode=list.find(list.from(bogusNode.childNodes),dom.isText);var bogusCharIdx=textNode.nodeValue.indexOf(dom.ZERO_WIDTH_NBSP_CHAR);if(bogusCharIdx!==-1){textNode.deleteData(bogusCharIdx,1);}if(dom.isEmpty(bogusNode)){dom.remove(bogusNode);}$editable.removeData(KEY_BOGUS);}; /**\n     * lineHeight\n     * @param {jQuery} $editable\n     * @param {String} value\n     */this.lineHeight=function($editable,value){beforeCommand($editable);style.stylePara(range.create(),{lineHeight:value});afterCommand($editable);}; /**\n     * unlink\n     *\n     * @type command\n     *\n     * @param {jQuery} $editable\n     */this.unlink=function($editable){var rng=this.createRange($editable);if(rng.isOnAnchor()){var anchor=dom.ancestor(rng.sc,dom.isAnchor);rng=range.createFromNode(anchor);rng.select();beforeCommand($editable);document.execCommand('unlink');afterCommand($editable);}}; /**\n     * create link (command)\n     *\n     * @param {jQuery} $editable\n     * @param {Object} linkInfo\n     * @param {Object} options\n     */this.createLink=function($editable,linkInfo,options){var linkUrl=linkInfo.url;var linkText=linkInfo.text;var isNewWindow=linkInfo.isNewWindow;var rng=linkInfo.range||this.createRange($editable);var isTextChanged=rng.toString()!==linkText;options=options||dom.makeLayoutInfo($editable).editor().data('options');beforeCommand($editable);if(options.onCreateLink){linkUrl=options.onCreateLink(linkUrl);}var anchors=[];if(isTextChanged){ // Create a new link when text changed.\nvar anchor=rng.insertNode($('<A>'+linkText+'</A>')[0]);anchors.push(anchor);}else {anchors=style.styleNodes(rng,{nodeName:'A',expandClosestSibling:true,onlyPartialContains:true});}$.each(anchors,function(idx,anchor){$(anchor).attr('href',linkUrl);if(isNewWindow){$(anchor).attr('target','_blank');}else {$(anchor).removeAttr('target');}});var startRange=range.createFromNodeBefore(list.head(anchors));var startPoint=startRange.getStartPoint();var endRange=range.createFromNodeAfter(list.last(anchors));var endPoint=endRange.getEndPoint();range.create(startPoint.node,startPoint.offset,endPoint.node,endPoint.offset).select();afterCommand($editable);}; /**\n     * returns link info\n     *\n     * @return {Object}\n     * @return {WrappedRange} return.range\n     * @return {String} return.text\n     * @return {Boolean} [return.isNewWindow=true]\n     * @return {String} [return.url=\"\"]\n     */this.getLinkInfo=function($editable){this.focus($editable);var rng=range.create().expand(dom.isAnchor); // Get the first anchor on range(for edit).\nvar $anchor=$(list.head(rng.nodes(dom.isAnchor)));return {range:rng,text:rng.toString(),isNewWindow:$anchor.length?$anchor.attr('target')==='_blank':false,url:$anchor.length?$anchor.attr('href'):''};}; /**\n     * setting color\n     *\n     * @param {Node} $editable\n     * @param {Object} sObjColor  color code\n     * @param {String} sObjColor.foreColor foreground color\n     * @param {String} sObjColor.backColor background color\n     */this.color=function($editable,sObjColor){var oColor=JSON.parse(sObjColor);var foreColor=oColor.foreColor,backColor=oColor.backColor;beforeCommand($editable);if(foreColor){document.execCommand('foreColor',false,foreColor);}if(backColor){document.execCommand('backColor',false,backColor);}afterCommand($editable);}; /**\n     * insert Table\n     *\n     * @param {Node} $editable\n     * @param {String} sDim dimension of table (ex : \"5x5\")\n     */this.insertTable=function($editable,sDim){var dimension=sDim.split('x');beforeCommand($editable);var rng=range.create().deleteContents();rng.insertNode(table.createTable(dimension[0],dimension[1]));afterCommand($editable);}; /**\n     * float me\n     *\n     * @param {jQuery} $editable\n     * @param {String} value\n     * @param {jQuery} $target\n     */this.floatMe=function($editable,value,$target){beforeCommand($editable); // bootstrap\n$target.removeClass('pull-left pull-right');if(value&&value!=='none'){$target.addClass('pull-'+value);} // fallback for non-bootstrap\n$target.css('float',value);afterCommand($editable);}; /**\n     * change image shape\n     *\n     * @param {jQuery} $editable\n     * @param {String} value css class\n     * @param {Node} $target\n     */this.imageShape=function($editable,value,$target){beforeCommand($editable);$target.removeClass('img-rounded img-circle img-thumbnail');if(value){$target.addClass(value);}afterCommand($editable);}; /**\n     * resize overlay element\n     * @param {jQuery} $editable\n     * @param {String} value\n     * @param {jQuery} $target - target element\n     */this.resize=function($editable,value,$target){beforeCommand($editable);$target.css({width:value*100+'%',height:''});afterCommand($editable);}; /**\n     * @param {Position} pos\n     * @param {jQuery} $target - target element\n     * @param {Boolean} [bKeepRatio] - keep ratio\n     */this.resizeTo=function(pos,$target,bKeepRatio){var imageSize;if(bKeepRatio){var newRatio=pos.y/pos.x;var ratio=$target.data('ratio');imageSize={width:ratio>newRatio?pos.x:pos.y/ratio,height:ratio>newRatio?pos.x*ratio:pos.y};}else {imageSize={width:pos.x,height:pos.y};}$target.css(imageSize);}; /**\n     * remove media object\n     *\n     * @param {jQuery} $editable\n     * @param {String} value - dummy argument (for keep interface)\n     * @param {jQuery} $target - target element\n     */this.removeMedia=function($editable,value,$target){beforeCommand($editable);$target.detach();handler.bindCustomEvent($(),$editable.data('callbacks'),'media.delete')($target,$editable);afterCommand($editable);}; /**\n     * set focus\n     *\n     * @param $editable\n     */this.focus=function($editable){$editable.focus(); // [workaround] for firefox bug http://goo.gl/lVfAaI\nif(agent.isFF&&!range.create().isOnEditable()){range.createFromNode($editable[0]).normalize().collapse().select();}}; /**\n     * returns whether contents is empty or not.\n     *\n     * @param {jQuery} $editable\n     * @return {Boolean}\n     */this.isEmpty=function($editable){return dom.isEmpty($editable[0])||dom.emptyPara===$editable.html();};}; /**\n   * @class module.Button\n   *\n   * Button\n   */var Button=function Button(){ /**\n     * update button status\n     *\n     * @param {jQuery} $container\n     * @param {Object} styleInfo\n     */this.update=function($container,styleInfo){ /**\n       * handle dropdown's check mark (for fontname, fontsize, lineHeight).\n       * @param {jQuery} $btn\n       * @param {Number} value\n       */var checkDropdownMenu=function checkDropdownMenu($btn,value){$btn.find('.dropdown-menu li a').each(function(){ // always compare string to avoid creating another func.\nvar isChecked=$(this).data('value')+''===value+'';this.className=isChecked?'checked':'';});}; /**\n       * update button state(active or not).\n       *\n       * @private\n       * @param {String} selector\n       * @param {Function} pred\n       */var btnState=function btnState(selector,pred){var $btn=$container.find(selector);$btn.toggleClass('active',pred());};if(styleInfo.image){var $img=$(styleInfo.image);btnState('button[data-event=\"imageShape\"][data-value=\"img-rounded\"]',function(){return $img.hasClass('img-rounded');});btnState('button[data-event=\"imageShape\"][data-value=\"img-circle\"]',function(){return $img.hasClass('img-circle');});btnState('button[data-event=\"imageShape\"][data-value=\"img-thumbnail\"]',function(){return $img.hasClass('img-thumbnail');});btnState('button[data-event=\"imageShape\"]:not([data-value])',function(){return !$img.is('.img-rounded, .img-circle, .img-thumbnail');});var imgFloat=$img.css('float');btnState('button[data-event=\"floatMe\"][data-value=\"left\"]',function(){return imgFloat==='left';});btnState('button[data-event=\"floatMe\"][data-value=\"right\"]',function(){return imgFloat==='right';});btnState('button[data-event=\"floatMe\"][data-value=\"none\"]',function(){return imgFloat!=='left'&&imgFloat!=='right';});var style=$img.attr('style');btnState('button[data-event=\"resize\"][data-value=\"1\"]',function(){return !!/(^|\\s)(max-)?width\\s*:\\s*100%/.test(style);});btnState('button[data-event=\"resize\"][data-value=\"0.5\"]',function(){return !!/(^|\\s)(max-)?width\\s*:\\s*50%/.test(style);});btnState('button[data-event=\"resize\"][data-value=\"0.25\"]',function(){return !!/(^|\\s)(max-)?width\\s*:\\s*25%/.test(style);});return;} // fontname\nvar $fontname=$container.find('.note-fontname');if($fontname.length){var selectedFont=styleInfo['font-family'];if(!!selectedFont){var list=selectedFont.split(',');for(var i=0,len=list.length;i<len;i++){selectedFont=list[i].replace(/[\\'\\\"]/g,'').replace(/\\s+$/,'').replace(/^\\s+/,'');if(agent.isFontInstalled(selectedFont)){break;}}$fontname.find('.note-current-fontname').text(selectedFont);checkDropdownMenu($fontname,selectedFont);}} // fontsize\nvar $fontsize=$container.find('.note-fontsize');$fontsize.find('.note-current-fontsize').text(styleInfo['font-size']);checkDropdownMenu($fontsize,parseFloat(styleInfo['font-size'])); // lineheight\nvar $lineHeight=$container.find('.note-height');checkDropdownMenu($lineHeight,parseFloat(styleInfo['line-height']));btnState('button[data-event=\"bold\"]',function(){return styleInfo['font-bold']==='bold';});btnState('button[data-event=\"italic\"]',function(){return styleInfo['font-italic']==='italic';});btnState('button[data-event=\"underline\"]',function(){return styleInfo['font-underline']==='underline';});btnState('button[data-event=\"strikethrough\"]',function(){return styleInfo['font-strikethrough']==='strikethrough';});btnState('button[data-event=\"superscript\"]',function(){return styleInfo['font-superscript']==='superscript';});btnState('button[data-event=\"subscript\"]',function(){return styleInfo['font-subscript']==='subscript';});btnState('button[data-event=\"justifyLeft\"]',function(){return styleInfo['text-align']==='left'||styleInfo['text-align']==='start';});btnState('button[data-event=\"justifyCenter\"]',function(){return styleInfo['text-align']==='center';});btnState('button[data-event=\"justifyRight\"]',function(){return styleInfo['text-align']==='right';});btnState('button[data-event=\"justifyFull\"]',function(){return styleInfo['text-align']==='justify';});btnState('button[data-event=\"insertUnorderedList\"]',function(){return styleInfo['list-style']==='unordered';});btnState('button[data-event=\"insertOrderedList\"]',function(){return styleInfo['list-style']==='ordered';});}; /**\n     * update recent color\n     *\n     * @param {Node} button\n     * @param {String} eventName\n     * @param {Mixed} value\n     */this.updateRecentColor=function(button,eventName,value){var $color=$(button).closest('.note-color');var $recentColor=$color.find('.note-recent-color');var colorInfo=JSON.parse($recentColor.attr('data-value'));colorInfo[eventName]=value;$recentColor.attr('data-value',JSON.stringify(colorInfo));var sKey=eventName==='backColor'?'background-color':'color';$recentColor.find('i').css(sKey,value);};}; /**\n   * @class module.Toolbar\n   *\n   * Toolbar\n   */var Toolbar=function Toolbar(){var button=new Button();this.update=function($toolbar,styleInfo){button.update($toolbar,styleInfo);}; /**\n     * @param {Node} button\n     * @param {String} eventName\n     * @param {String} value\n     */this.updateRecentColor=function(buttonNode,eventName,value){button.updateRecentColor(buttonNode,eventName,value);}; /**\n     * activate buttons exclude codeview\n     * @param {jQuery} $toolbar\n     */this.activate=function($toolbar){$toolbar.find('button').not('button[data-event=\"codeview\"]').removeClass('disabled');}; /**\n     * deactivate buttons exclude codeview\n     * @param {jQuery} $toolbar\n     */this.deactivate=function($toolbar){$toolbar.find('button').not('button[data-event=\"codeview\"]').addClass('disabled');}; /**\n     * @param {jQuery} $container\n     * @param {Boolean} [bFullscreen=false]\n     */this.updateFullscreen=function($container,bFullscreen){var $btn=$container.find('button[data-event=\"fullscreen\"]');$btn.toggleClass('active',bFullscreen);}; /**\n     * @param {jQuery} $container\n     * @param {Boolean} [isCodeview=false]\n     */this.updateCodeview=function($container,isCodeview){var $btn=$container.find('button[data-event=\"codeview\"]');$btn.toggleClass('active',isCodeview);if(isCodeview){this.deactivate($container);}else {this.activate($container);}}; /**\n     * get button in toolbar \n     *\n     * @param {jQuery} $editable\n     * @param {String} name\n     * @return {jQuery}\n     */this.get=function($editable,name){var $toolbar=dom.makeLayoutInfo($editable).toolbar();return $toolbar.find('[data-name='+name+']');}; /**\n     * set button state\n     * @param {jQuery} $editable\n     * @param {String} name\n     * @param {Boolean} [isActive=true]\n     */this.setButtonState=function($editable,name,isActive){isActive=isActive===false?false:true;var $button=this.get($editable,name);$button.toggleClass('active',isActive);};};var EDITABLE_PADDING=24;var Statusbar=function Statusbar(){var $document=$(document);this.attach=function(layoutInfo,options){if(!options.disableResizeEditor){layoutInfo.statusbar().on('mousedown',hStatusbarMousedown);}}; /**\n     * `mousedown` event handler on statusbar\n     *\n     * @param {MouseEvent} event\n     */var hStatusbarMousedown=function hStatusbarMousedown(event){event.preventDefault();event.stopPropagation();var $editable=dom.makeLayoutInfo(event.target).editable();var editableTop=$editable.offset().top-$document.scrollTop();var layoutInfo=dom.makeLayoutInfo(event.currentTarget||event.target);var options=layoutInfo.editor().data('options');$document.on('mousemove',function(event){var nHeight=event.clientY-(editableTop+EDITABLE_PADDING);nHeight=options.minHeight>0?Math.max(nHeight,options.minHeight):nHeight;nHeight=options.maxHeight>0?Math.min(nHeight,options.maxHeight):nHeight;$editable.height(nHeight);}).one('mouseup',function(){$document.off('mousemove');});};}; /**\n   * @class module.Popover\n   *\n   * Popover (http://getbootstrap.com/javascript/#popovers)\n   *\n   */var Popover=function Popover(){var button=new Button(); /**\n     * returns position from placeholder\n     *\n     * @private\n     * @param {Node} placeholder\n     * @param {Object} options\n     * @param {Boolean} options.isAirMode\n     * @return {Position}\n     */var posFromPlaceholder=function posFromPlaceholder(placeholder,options){var isAirMode=options&&options.isAirMode;var isLeftTop=options&&options.isLeftTop;var $placeholder=$(placeholder);var pos=isAirMode?$placeholder.offset():$placeholder.position();var height=isLeftTop?0:$placeholder.outerHeight(true); // include margin\n// popover below placeholder.\nreturn {left:pos.left,top:pos.top+height};}; /**\n     * show popover\n     *\n     * @private\n     * @param {jQuery} popover\n     * @param {Position} pos\n     */var showPopover=function showPopover($popover,pos){$popover.css({display:'block',left:pos.left,top:pos.top});};var PX_POPOVER_ARROW_OFFSET_X=20; /**\n     * update current state\n     * @param {jQuery} $popover - popover container\n     * @param {Object} styleInfo - style object\n     * @param {Boolean} isAirMode\n     */this.update=function($popover,styleInfo,isAirMode){button.update($popover,styleInfo);var $linkPopover=$popover.find('.note-link-popover');if(styleInfo.anchor){var $anchor=$linkPopover.find('a');var href=$(styleInfo.anchor).attr('href');var target=$(styleInfo.anchor).attr('target');$anchor.attr('href',href).html(href);if(!target){$anchor.removeAttr('target');}else {$anchor.attr('target','_blank');}showPopover($linkPopover,posFromPlaceholder(styleInfo.anchor,{isAirMode:isAirMode}));}else {$linkPopover.hide();}var $imagePopover=$popover.find('.note-image-popover');if(styleInfo.image){showPopover($imagePopover,posFromPlaceholder(styleInfo.image,{isAirMode:isAirMode,isLeftTop:true}));}else {$imagePopover.hide();}var $airPopover=$popover.find('.note-air-popover');if(isAirMode&&styleInfo.range&&!styleInfo.range.isCollapsed()){var rect=list.last(styleInfo.range.getClientRects());if(rect){var bnd=func.rect2bnd(rect);showPopover($airPopover,{left:Math.max(bnd.left+bnd.width/2-PX_POPOVER_ARROW_OFFSET_X,0),top:bnd.top+bnd.height});}}else {$airPopover.hide();}}; /**\n     * @param {Node} button\n     * @param {String} eventName\n     * @param {String} value\n     */this.updateRecentColor=function(button,eventName,value){button.updateRecentColor(button,eventName,value);}; /**\n     * hide all popovers\n     * @param {jQuery} $popover - popover container\n     */this.hide=function($popover){$popover.children().hide();};}; /**\n   * @class module.Handle\n   *\n   * Handle\n   */var Handle=function Handle(handler){var $document=$(document); /**\n     * `mousedown` event handler on $handle\n     *  - controlSizing: resize image\n     *\n     * @param {MouseEvent} event\n     */var hHandleMousedown=function hHandleMousedown(event){if(dom.isControlSizing(event.target)){event.preventDefault();event.stopPropagation();var layoutInfo=dom.makeLayoutInfo(event.target),$handle=layoutInfo.handle(),$popover=layoutInfo.popover(),$editable=layoutInfo.editable(),$editor=layoutInfo.editor();var target=$handle.find('.note-control-selection').data('target'),$target=$(target),posStart=$target.offset(),scrollTop=$document.scrollTop();var isAirMode=$editor.data('options').airMode;$document.on('mousemove',function(event){handler.invoke('editor.resizeTo',{x:event.clientX-posStart.left,y:event.clientY-(posStart.top-scrollTop)},$target,!event.shiftKey);handler.invoke('handle.update',$handle,{image:target},isAirMode);handler.invoke('popover.update',$popover,{image:target},isAirMode);}).one('mouseup',function(){$document.off('mousemove');handler.invoke('editor.afterCommand',$editable);});if(!$target.data('ratio')){ // original ratio.\n$target.data('ratio',$target.height()/$target.width());}}};this.attach=function(layoutInfo){layoutInfo.handle().on('mousedown',hHandleMousedown);}; /**\n     * update handle\n     * @param {jQuery} $handle\n     * @param {Object} styleInfo\n     * @param {Boolean} isAirMode\n     */this.update=function($handle,styleInfo,isAirMode){var $selection=$handle.find('.note-control-selection');if(styleInfo.image){var $image=$(styleInfo.image);var pos=isAirMode?$image.offset():$image.position(); // include margin\nvar imageSize={w:$image.outerWidth(true),h:$image.outerHeight(true)};$selection.css({display:'block',left:pos.left,top:pos.top,width:imageSize.w,height:imageSize.h}).data('target',styleInfo.image); // save current image element.\nvar sizingText=imageSize.w+'x'+imageSize.h;$selection.find('.note-control-selection-info').text(sizingText);}else {$selection.hide();}}; /**\n     * hide\n     *\n     * @param {jQuery} $handle\n     */this.hide=function($handle){$handle.children().hide();};};var Fullscreen=function Fullscreen(handler){var $window=$(window);var $scrollbar=$('html, body'); /**\n     * toggle fullscreen\n     *\n     * @param {Object} layoutInfo\n     */this.toggle=function(layoutInfo){var $editor=layoutInfo.editor(),$toolbar=layoutInfo.toolbar(),$editable=layoutInfo.editable(),$codable=layoutInfo.codable();var resize=function resize(size){$editable.css('height',size.h);$codable.css('height',size.h);if($codable.data('cmeditor')){$codable.data('cmeditor').setsize(null,size.h);}};$editor.toggleClass('fullscreen');var isFullscreen=$editor.hasClass('fullscreen');if(isFullscreen){$editable.data('orgheight',$editable.css('height'));$window.on('resize',function(){resize({h:$window.height()-$toolbar.outerHeight()});}).trigger('resize');$scrollbar.css('overflow','hidden');}else {$window.off('resize');resize({h:$editable.data('orgheight')});$scrollbar.css('overflow','visible');}handler.invoke('toolbar.updateFullscreen',$toolbar,isFullscreen);};};var CodeMirror;if(agent.hasCodeMirror){if(agent.isSupportAmd){require(['CodeMirror'],function(cm){CodeMirror=cm;});}else {CodeMirror=window.CodeMirror;}} /**\n   * @class Codeview\n   */var Codeview=function Codeview(handler){this.sync=function(layoutInfo){var isCodeview=handler.invoke('codeview.isActivated',layoutInfo);if(isCodeview&&agent.hasCodeMirror){layoutInfo.codable().data('cmEditor').save();}}; /**\n     * @param {Object} layoutInfo\n     * @return {Boolean}\n     */this.isActivated=function(layoutInfo){var $editor=layoutInfo.editor();return $editor.hasClass('codeview');}; /**\n     * toggle codeview\n     *\n     * @param {Object} layoutInfo\n     */this.toggle=function(layoutInfo){if(this.isActivated(layoutInfo)){this.deactivate(layoutInfo);}else {this.activate(layoutInfo);}}; /**\n     * activate code view\n     *\n     * @param {Object} layoutInfo\n     */this.activate=function(layoutInfo){var $editor=layoutInfo.editor(),$toolbar=layoutInfo.toolbar(),$editable=layoutInfo.editable(),$codable=layoutInfo.codable(),$popover=layoutInfo.popover(),$handle=layoutInfo.handle();var options=$editor.data('options');$codable.val(dom.html($editable,options.prettifyHtml));$codable.height($editable.height());handler.invoke('toolbar.updateCodeview',$toolbar,true);handler.invoke('popover.hide',$popover);handler.invoke('handle.hide',$handle);$editor.addClass('codeview');$codable.focus(); // activate CodeMirror as codable\nif(agent.hasCodeMirror){var cmEditor=CodeMirror.fromTextArea($codable[0],options.codemirror); // CodeMirror TernServer\nif(options.codemirror.tern){var server=new CodeMirror.TernServer(options.codemirror.tern);cmEditor.ternServer=server;cmEditor.on('cursorActivity',function(cm){server.updateArgHints(cm);});} // CodeMirror hasn't Padding.\ncmEditor.setSize(null,$editable.outerHeight());$codable.data('cmEditor',cmEditor);}}; /**\n     * deactivate code view\n     *\n     * @param {Object} layoutInfo\n     */this.deactivate=function(layoutInfo){var $holder=layoutInfo.holder(),$editor=layoutInfo.editor(),$toolbar=layoutInfo.toolbar(),$editable=layoutInfo.editable(),$codable=layoutInfo.codable();var options=$editor.data('options'); // deactivate CodeMirror as codable\nif(agent.hasCodeMirror){var cmEditor=$codable.data('cmEditor');$codable.val(cmEditor.getValue());cmEditor.toTextArea();}var value=dom.value($codable,options.prettifyHtml)||dom.emptyPara;var isChange=$editable.html()!==value;$editable.html(value);$editable.height(options.height?$codable.height():'auto');$editor.removeClass('codeview');if(isChange){handler.bindCustomEvent($holder,$editable.data('callbacks'),'change')($editable.html(),$editable);}$editable.focus();handler.invoke('toolbar.updateCodeview',$toolbar,false);};};var DragAndDrop=function DragAndDrop(handler){var $document=$(document); /**\n     * attach Drag and Drop Events\n     *\n     * @param {Object} layoutInfo - layout Informations\n     * @param {Object} options\n     */this.attach=function(layoutInfo,options){if(options.airMode||options.disableDragAndDrop){ // prevent default drop event\n$document.on('drop',function(e){e.preventDefault();});}else {this.attachDragAndDropEvent(layoutInfo,options);}}; /**\n     * attach Drag and Drop Events\n     *\n     * @param {Object} layoutInfo - layout Informations\n     * @param {Object} options\n     */this.attachDragAndDropEvent=function(layoutInfo,options){var collection=$(),$editor=layoutInfo.editor(),$dropzone=layoutInfo.dropzone(),$dropzoneMessage=$dropzone.find('.note-dropzone-message'); // show dropzone on dragenter when dragging a object to document\n// -but only if the editor is visible, i.e. has a positive width and height\n$document.on('dragenter',function(e){var isCodeview=handler.invoke('codeview.isActivated',layoutInfo);var hasEditorSize=$editor.width()>0&&$editor.height()>0;if(!isCodeview&&!collection.length&&hasEditorSize){$editor.addClass('dragover');$dropzone.width($editor.width());$dropzone.height($editor.height());$dropzoneMessage.text(options.langInfo.image.dragImageHere);}collection=collection.add(e.target);}).on('dragleave',function(e){collection=collection.not(e.target);if(!collection.length){$editor.removeClass('dragover');}}).on('drop',function(){collection=$();$editor.removeClass('dragover');}); // change dropzone's message on hover.\n$dropzone.on('dragenter',function(){$dropzone.addClass('hover');$dropzoneMessage.text(options.langInfo.image.dropImage);}).on('dragleave',function(){$dropzone.removeClass('hover');$dropzoneMessage.text(options.langInfo.image.dragImageHere);}); // attach dropImage\n$dropzone.on('drop',function(event){var dataTransfer=event.originalEvent.dataTransfer;var layoutInfo=dom.makeLayoutInfo(event.currentTarget||event.target);if(dataTransfer&&dataTransfer.files&&dataTransfer.files.length){event.preventDefault();layoutInfo.editable().focus();handler.insertImages(layoutInfo,dataTransfer.files);}else {var insertNodefunc=function insertNodefunc(){layoutInfo.holder().summernote('insertNode',this);};for(var i=0,len=dataTransfer.types.length;i<len;i++){var type=dataTransfer.types[i];var content=dataTransfer.getData(type);if(type.toLowerCase().indexOf('text')>-1){layoutInfo.holder().summernote('pasteHTML',content);}else {$(content).each(insertNodefunc);}}}}).on('dragover',false); // prevent default dragover event\n};};var Clipboard=function Clipboard(handler){var $paste;this.attach=function(layoutInfo){ // [workaround] getting image from clipboard\n//  - IE11 and Firefox: CTRL+v hook\n//  - Webkit: event.clipboardData\nif(agent.isMSIE&&agent.browserVersion>10||agent.isFF){$paste=$('<div />').attr('contenteditable',true).css({position:'absolute',left:-100000,opacity:0});layoutInfo.editable().on('keydown',function(e){if(e.ctrlKey&&e.keyCode===key.code.V){handler.invoke('saveRange',layoutInfo.editable());$paste.focus();setTimeout(function(){pasteByHook(layoutInfo);},0);}});layoutInfo.editable().before($paste);}else {layoutInfo.editable().on('paste',pasteByEvent);}};var pasteByHook=function pasteByHook(layoutInfo){var $editable=layoutInfo.editable();var node=$paste[0].firstChild;if(dom.isImg(node)){var dataURI=node.src;var decodedData=atob(dataURI.split(',')[1]);var array=new Uint8Array(decodedData.length);for(var i=0;i<decodedData.length;i++){array[i]=decodedData.charCodeAt(i);}var blob=new Blob([array],{type:'image/png'});blob.name='clipboard.png';handler.invoke('restoreRange',$editable);handler.invoke('focus',$editable);handler.insertImages(layoutInfo,[blob]);}else {var pasteContent=$('<div />').html($paste.html()).html();handler.invoke('restoreRange',$editable);handler.invoke('focus',$editable);if(pasteContent){handler.invoke('pasteHTML',$editable,pasteContent);}}$paste.empty();}; /**\n     * paste by clipboard event\n     *\n     * @param {Event} event\n     */var pasteByEvent=function pasteByEvent(event){var clipboardData=event.originalEvent.clipboardData;var layoutInfo=dom.makeLayoutInfo(event.currentTarget||event.target);var $editable=layoutInfo.editable();if(clipboardData&&clipboardData.items&&clipboardData.items.length){var item=list.head(clipboardData.items);if(item.kind==='file'&&item.type.indexOf('image/')!==-1){handler.insertImages(layoutInfo,[item.getAsFile()]);}handler.invoke('editor.afterCommand',$editable);}};};var LinkDialog=function LinkDialog(handler){ /**\n     * toggle button status\n     *\n     * @private\n     * @param {jQuery} $btn\n     * @param {Boolean} isEnable\n     */var toggleBtn=function toggleBtn($btn,isEnable){$btn.toggleClass('disabled',!isEnable);$btn.attr('disabled',!isEnable);}; /**\n     * bind enter key\n     *\n     * @private\n     * @param {jQuery} $input\n     * @param {jQuery} $btn\n     */var bindEnterKey=function bindEnterKey($input,$btn){$input.on('keypress',function(event){if(event.keyCode===key.code.ENTER){$btn.trigger('click');}});}; /**\n     * Show link dialog and set event handlers on dialog controls.\n     *\n     * @param {jQuery} $editable\n     * @param {jQuery} $dialog\n     * @param {Object} linkInfo\n     * @return {Promise}\n     */this.showLinkDialog=function($editable,$dialog,linkInfo){return $.Deferred(function(deferred){var $linkDialog=$dialog.find('.note-link-dialog');var $linkText=$linkDialog.find('.note-link-text'),$linkUrl=$linkDialog.find('.note-link-url'),$linkBtn=$linkDialog.find('.note-link-btn'),$openInNewWindow=$linkDialog.find('input[type=checkbox]');$linkDialog.one('shown.bs.modal',function(){$linkText.val(linkInfo.text);$linkText.on('input',function(){toggleBtn($linkBtn,$linkText.val()&&$linkUrl.val()); // if linktext was modified by keyup,\n// stop cloning text from linkUrl\nlinkInfo.text=$linkText.val();}); // if no url was given, copy text to url\nif(!linkInfo.url){linkInfo.url=linkInfo.text||'http://';toggleBtn($linkBtn,linkInfo.text);}$linkUrl.on('input',function(){toggleBtn($linkBtn,$linkText.val()&&$linkUrl.val()); // display same link on `Text to display` input\n// when create a new link\nif(!linkInfo.text){$linkText.val($linkUrl.val());}}).val(linkInfo.url).trigger('focus').trigger('select');bindEnterKey($linkUrl,$linkBtn);bindEnterKey($linkText,$linkBtn);$openInNewWindow.prop('checked',linkInfo.isNewWindow);$linkBtn.one('click',function(event){event.preventDefault();deferred.resolve({range:linkInfo.range,url:$linkUrl.val(),text:$linkText.val(),isNewWindow:$openInNewWindow.is(':checked')});$linkDialog.modal('hide');});}).one('hidden.bs.modal',function(){ // detach events\n$linkText.off('input keypress');$linkUrl.off('input keypress');$linkBtn.off('click');if(deferred.state()==='pending'){deferred.reject();}}).modal('show');}).promise();}; /**\n     * @param {Object} layoutInfo\n     */this.show=function(layoutInfo){var $editor=layoutInfo.editor(),$dialog=layoutInfo.dialog(),$editable=layoutInfo.editable(),$popover=layoutInfo.popover(),linkInfo=handler.invoke('editor.getLinkInfo',$editable);var options=$editor.data('options');handler.invoke('editor.saveRange',$editable);this.showLinkDialog($editable,$dialog,linkInfo).then(function(linkInfo){handler.invoke('editor.restoreRange',$editable);handler.invoke('editor.createLink',$editable,linkInfo,options); // hide popover after creating link\nhandler.invoke('popover.hide',$popover);}).fail(function(){handler.invoke('editor.restoreRange',$editable);});};};var ImageDialog=function ImageDialog(handler){ /**\n     * toggle button status\n     *\n     * @private\n     * @param {jQuery} $btn\n     * @param {Boolean} isEnable\n     */var toggleBtn=function toggleBtn($btn,isEnable){$btn.toggleClass('disabled',!isEnable);$btn.attr('disabled',!isEnable);}; /**\n     * bind enter key\n     *\n     * @private\n     * @param {jQuery} $input\n     * @param {jQuery} $btn\n     */var bindEnterKey=function bindEnterKey($input,$btn){$input.on('keypress',function(event){if(event.keyCode===key.code.ENTER){$btn.trigger('click');}});};this.show=function(layoutInfo){var $dialog=layoutInfo.dialog(),$editable=layoutInfo.editable();handler.invoke('editor.saveRange',$editable);this.showImageDialog($editable,$dialog).then(function(data){handler.invoke('editor.restoreRange',$editable);if(typeof data==='string'){ // image url\nhandler.invoke('editor.insertImage',$editable,data);}else { // array of files\nhandler.insertImages(layoutInfo,data);}}).fail(function(){handler.invoke('editor.restoreRange',$editable);});}; /**\n     * show image dialog\n     *\n     * @param {jQuery} $editable\n     * @param {jQuery} $dialog\n     * @return {Promise}\n     */this.showImageDialog=function($editable,$dialog){return $.Deferred(function(deferred){var $imageDialog=$dialog.find('.note-image-dialog');var $imageInput=$dialog.find('.note-image-input'),$imageUrl=$dialog.find('.note-image-url'),$imageBtn=$dialog.find('.note-image-btn');$imageDialog.one('shown.bs.modal',function(){ // Cloning imageInput to clear element.\n$imageInput.replaceWith($imageInput.clone().on('change',function(){deferred.resolve(this.files||this.value);$imageDialog.modal('hide');}).val(''));$imageBtn.click(function(event){event.preventDefault();deferred.resolve($imageUrl.val());$imageDialog.modal('hide');});$imageUrl.on('keyup paste',function(event){var url;if(event.type==='paste'){url=event.originalEvent.clipboardData.getData('text');}else {url=$imageUrl.val();}toggleBtn($imageBtn,url);}).val('').trigger('focus');bindEnterKey($imageUrl,$imageBtn);}).one('hidden.bs.modal',function(){$imageInput.off('change');$imageUrl.off('keyup paste keypress');$imageBtn.off('click');if(deferred.state()==='pending'){deferred.reject();}}).modal('show');});};};var HelpDialog=function HelpDialog(handler){ /**\n     * show help dialog\n     *\n     * @param {jQuery} $editable\n     * @param {jQuery} $dialog\n     * @return {Promise}\n     */this.showHelpDialog=function($editable,$dialog){return $.Deferred(function(deferred){var $helpDialog=$dialog.find('.note-help-dialog');$helpDialog.one('hidden.bs.modal',function(){deferred.resolve();}).modal('show');}).promise();}; /**\n     * @param {Object} layoutInfo\n     */this.show=function(layoutInfo){var $dialog=layoutInfo.dialog(),$editable=layoutInfo.editable();handler.invoke('editor.saveRange',$editable,true);this.showHelpDialog($editable,$dialog).then(function(){handler.invoke('editor.restoreRange',$editable);});};}; /**\n   * @class EventHandler\n   *\n   * EventHandler\n   *  - TODO: new instance per a editor\n   */var EventHandler=function EventHandler(){var self=this; /**\n     * Modules\n     */var modules=this.modules={editor:new Editor(this),toolbar:new Toolbar(this),statusbar:new Statusbar(this),popover:new Popover(this),handle:new Handle(this),fullscreen:new Fullscreen(this),codeview:new Codeview(this),dragAndDrop:new DragAndDrop(this),clipboard:new Clipboard(this),linkDialog:new LinkDialog(this),imageDialog:new ImageDialog(this),helpDialog:new HelpDialog(this)}; /**\n     * invoke module's method\n     *\n     * @param {String} moduleAndMethod - ex) 'editor.redo'\n     * @param {...*} arguments - arguments of method\n     * @return {*}\n     */this.invoke=function(){var moduleAndMethod=list.head(list.from(arguments));var args=list.tail(list.from(arguments));var splits=moduleAndMethod.split('.');var hasSeparator=splits.length>1;var moduleName=hasSeparator&&list.head(splits);var methodName=hasSeparator?list.last(splits):list.head(splits);var module=this.getModule(moduleName);var method=module[methodName];return method&&method.apply(module,args);}; /**\n     * returns module\n     *\n     * @param {String} moduleName - name of module\n     * @return {Module} - defaults is editor\n     */this.getModule=function(moduleName){return this.modules[moduleName]||this.modules.editor;}; /**\n     * @param {jQuery} $holder\n     * @param {Object} callbacks\n     * @param {String} eventNamespace\n     * @returns {Function}\n     */var bindCustomEvent=this.bindCustomEvent=function($holder,callbacks,eventNamespace){return function(){var callback=callbacks[func.namespaceToCamel(eventNamespace,'on')];if(callback){callback.apply($holder[0],arguments);}return $holder.trigger('summernote.'+eventNamespace,arguments);};}; /**\n     * insert Images from file array.\n     *\n     * @private\n     * @param {Object} layoutInfo\n     * @param {File[]} files\n     */this.insertImages=function(layoutInfo,files){var $editor=layoutInfo.editor(),$editable=layoutInfo.editable(),$holder=layoutInfo.holder();var callbacks=$editable.data('callbacks');var options=$editor.data('options'); // If onImageUpload options setted\nif(callbacks.onImageUpload){bindCustomEvent($holder,callbacks,'image.upload')(files); // else insert Image as dataURL\n}else {$.each(files,function(idx,file){var filename=file.name;if(options.maximumImageFileSize&&options.maximumImageFileSize<file.size){bindCustomEvent($holder,callbacks,'image.upload.error')(options.langInfo.image.maximumFileSizeError);}else {async.readFileAsDataURL(file).then(function(sDataURL){modules.editor.insertImage($editable,sDataURL,filename);}).fail(function(){bindCustomEvent($holder,callbacks,'image.upload.error')(options.langInfo.image.maximumFileSizeError);});}});}};var commands={ /**\n       * @param {Object} layoutInfo\n       */showLinkDialog:function showLinkDialog(layoutInfo){modules.linkDialog.show(layoutInfo);}, /**\n       * @param {Object} layoutInfo\n       */showImageDialog:function showImageDialog(layoutInfo){modules.imageDialog.show(layoutInfo);}, /**\n       * @param {Object} layoutInfo\n       */showHelpDialog:function showHelpDialog(layoutInfo){modules.helpDialog.show(layoutInfo);}, /**\n       * @param {Object} layoutInfo\n       */fullscreen:function fullscreen(layoutInfo){modules.fullscreen.toggle(layoutInfo);}, /**\n       * @param {Object} layoutInfo\n       */codeview:function codeview(layoutInfo){modules.codeview.toggle(layoutInfo);}};var hMousedown=function hMousedown(event){ //preventDefault Selection for FF, IE8+\nif(dom.isImg(event.target)){event.preventDefault();}};var hKeyupAndMouseup=function hKeyupAndMouseup(event){var layoutInfo=dom.makeLayoutInfo(event.currentTarget||event.target);modules.editor.removeBogus(layoutInfo.editable());hToolbarAndPopoverUpdate(event);}; /**\n     * update sytle info\n     * @param {Object} styleInfo\n     * @param {Object} layoutInfo\n     */this.updateStyleInfo=function(styleInfo,layoutInfo){if(!styleInfo){return;}var isAirMode=layoutInfo.editor().data('options').airMode;if(!isAirMode){modules.toolbar.update(layoutInfo.toolbar(),styleInfo);}modules.popover.update(layoutInfo.popover(),styleInfo,isAirMode);modules.handle.update(layoutInfo.handle(),styleInfo,isAirMode);};var hToolbarAndPopoverUpdate=function hToolbarAndPopoverUpdate(event){var target=event.target; // delay for range after mouseup\nsetTimeout(function(){var layoutInfo=dom.makeLayoutInfo(target);var styleInfo=modules.editor.currentStyle(target);self.updateStyleInfo(styleInfo,layoutInfo);},0);};var hScroll=function hScroll(event){var layoutInfo=dom.makeLayoutInfo(event.currentTarget||event.target); //hide popover and handle when scrolled\nmodules.popover.hide(layoutInfo.popover());modules.handle.hide(layoutInfo.handle());};var hToolbarAndPopoverMousedown=function hToolbarAndPopoverMousedown(event){ // prevent default event when insertTable (FF, Webkit)\nvar $btn=$(event.target).closest('[data-event]');if($btn.length){event.preventDefault();}};var hToolbarAndPopoverClick=function hToolbarAndPopoverClick(event){var $btn=$(event.target).closest('[data-event]');if(!$btn.length){return;}var eventName=$btn.attr('data-event'),value=$btn.attr('data-value'),hide=$btn.attr('data-hide');var layoutInfo=dom.makeLayoutInfo(event.target); // before command: detect control selection element($target)\nvar $target;if($.inArray(eventName,['resize','floatMe','removeMedia','imageShape'])!==-1){var $selection=layoutInfo.handle().find('.note-control-selection');$target=$($selection.data('target'));} // If requested, hide the popover when the button is clicked.\n// Useful for things like showHelpDialog.\nif(hide){$btn.parents('.popover').hide();}if($.isFunction($.summernote.pluginEvents[eventName])){$.summernote.pluginEvents[eventName](event,modules.editor,layoutInfo,value);}else if(modules.editor[eventName]){ // on command\nvar $editable=layoutInfo.editable();$editable.focus();modules.editor[eventName]($editable,value,$target);event.preventDefault();}else if(commands[eventName]){commands[eventName].call(this,layoutInfo);event.preventDefault();} // after command\nif($.inArray(eventName,['backColor','foreColor'])!==-1){var options=layoutInfo.editor().data('options',options);var module=options.airMode?modules.popover:modules.toolbar;module.updateRecentColor(list.head($btn),eventName,value);}hToolbarAndPopoverUpdate(event);};var PX_PER_EM=18;var hDimensionPickerMove=function hDimensionPickerMove(event,options){var $picker=$(event.target.parentNode); // target is mousecatcher\nvar $dimensionDisplay=$picker.next();var $catcher=$picker.find('.note-dimension-picker-mousecatcher');var $highlighted=$picker.find('.note-dimension-picker-highlighted');var $unhighlighted=$picker.find('.note-dimension-picker-unhighlighted');var posOffset; // HTML5 with jQuery - e.offsetX is undefined in Firefox\nif(event.offsetX===undefined){var posCatcher=$(event.target).offset();posOffset={x:event.pageX-posCatcher.left,y:event.pageY-posCatcher.top};}else {posOffset={x:event.offsetX,y:event.offsetY};}var dim={c:Math.ceil(posOffset.x/PX_PER_EM)||1,r:Math.ceil(posOffset.y/PX_PER_EM)||1};$highlighted.css({width:dim.c+'em',height:dim.r+'em'});$catcher.attr('data-value',dim.c+'x'+dim.r);if(3<dim.c&&dim.c<options.insertTableMaxSize.col){$unhighlighted.css({width:dim.c+1+'em'});}if(3<dim.r&&dim.r<options.insertTableMaxSize.row){$unhighlighted.css({height:dim.r+1+'em'});}$dimensionDisplay.html(dim.c+' x '+dim.r);}; /**\n     * bind KeyMap on keydown\n     *\n     * @param {Object} layoutInfo\n     * @param {Object} keyMap\n     */this.bindKeyMap=function(layoutInfo,keyMap){var $editor=layoutInfo.editor();var $editable=layoutInfo.editable();$editable.on('keydown',function(event){var keys=[]; // modifier\nif(event.metaKey){keys.push('CMD');}if(event.ctrlKey&&!event.altKey){keys.push('CTRL');}if(event.shiftKey){keys.push('SHIFT');} // keycode\nvar keyName=key.nameFromCode[event.keyCode];if(keyName){keys.push(keyName);}var pluginEvent;var keyString=keys.join('+');var eventName=keyMap[keyString];if(eventName){ // FIXME Summernote doesn't support event pipeline yet.\n//  - Plugin -> Base Code\npluginEvent=$.summernote.pluginEvents[keyString];if($.isFunction(pluginEvent)){if(pluginEvent(event,modules.editor,layoutInfo)){return false;}}pluginEvent=$.summernote.pluginEvents[eventName];if($.isFunction(pluginEvent)){pluginEvent(event,modules.editor,layoutInfo);}else if(modules.editor[eventName]){modules.editor[eventName]($editable,$editor.data('options'));event.preventDefault();}else if(commands[eventName]){commands[eventName].call(this,layoutInfo);event.preventDefault();}}else if(key.isEdit(event.keyCode)){modules.editor.afterCommand($editable);}});}; /**\n     * attach eventhandler\n     *\n     * @param {Object} layoutInfo - layout Informations\n     * @param {Object} options - user options include custom event handlers\n     */this.attach=function(layoutInfo,options){ // handlers for editable\nif(options.shortcuts){this.bindKeyMap(layoutInfo,options.keyMap[agent.isMac?'mac':'pc']);}layoutInfo.editable().on('mousedown',hMousedown);layoutInfo.editable().on('keyup mouseup',hKeyupAndMouseup);layoutInfo.editable().on('scroll',hScroll); // handler for clipboard\nmodules.clipboard.attach(layoutInfo,options); // handler for handle and popover\nmodules.handle.attach(layoutInfo,options);layoutInfo.popover().on('click',hToolbarAndPopoverClick);layoutInfo.popover().on('mousedown',hToolbarAndPopoverMousedown); // handler for drag and drop\nmodules.dragAndDrop.attach(layoutInfo,options); // handlers for frame mode (toolbar, statusbar)\nif(!options.airMode){ // handler for toolbar\nlayoutInfo.toolbar().on('click',hToolbarAndPopoverClick);layoutInfo.toolbar().on('mousedown',hToolbarAndPopoverMousedown); // handler for statusbar\nmodules.statusbar.attach(layoutInfo,options);} // handler for table dimension\nvar $catcherContainer=options.airMode?layoutInfo.popover():layoutInfo.toolbar();var $catcher=$catcherContainer.find('.note-dimension-picker-mousecatcher');$catcher.css({width:options.insertTableMaxSize.col+'em',height:options.insertTableMaxSize.row+'em'}).on('mousemove',function(event){hDimensionPickerMove(event,options);}); // save options on editor\nlayoutInfo.editor().data('options',options); // ret styleWithCSS for backColor / foreColor clearing with 'inherit'.\nif(!agent.isMSIE){ // [workaround] for Firefox\n//  - protect FF Error: NS_ERROR_FAILURE: Failure\nsetTimeout(function(){document.execCommand('styleWithCSS',0,options.styleWithSpan);},0);} // History\nvar history=new History(layoutInfo.editable());layoutInfo.editable().data('NoteHistory',history); // All editor status will be saved on editable with jquery's data\n// for support multiple editor with singleton object.\nlayoutInfo.editable().data('callbacks',{onInit:options.onInit,onFocus:options.onFocus,onBlur:options.onBlur,onKeydown:options.onKeydown,onKeyup:options.onKeyup,onMousedown:options.onMousedown,onEnter:options.onEnter,onPaste:options.onPaste,onBeforeCommand:options.onBeforeCommand,onChange:options.onChange,onImageUpload:options.onImageUpload,onImageUploadError:options.onImageUploadError,onMediaDelete:options.onMediaDelete,onToolbarClick:options.onToolbarClick});var styleInfo=modules.editor.styleFromNode(layoutInfo.editable());this.updateStyleInfo(styleInfo,layoutInfo);}; /**\n     * attach jquery custom event\n     *\n     * @param {Object} layoutInfo - layout Informations\n     */this.attachCustomEvent=function(layoutInfo,options){var $holder=layoutInfo.holder();var $editable=layoutInfo.editable();var callbacks=$editable.data('callbacks');$editable.focus(bindCustomEvent($holder,callbacks,'focus'));$editable.blur(bindCustomEvent($holder,callbacks,'blur'));$editable.keydown(function(event){if(event.keyCode===key.code.ENTER){bindCustomEvent($holder,callbacks,'enter').call(this,event);}bindCustomEvent($holder,callbacks,'keydown').call(this,event);});$editable.keyup(bindCustomEvent($holder,callbacks,'keyup'));$editable.on('mousedown',bindCustomEvent($holder,callbacks,'mousedown'));$editable.on('mouseup',bindCustomEvent($holder,callbacks,'mouseup'));$editable.on('scroll',bindCustomEvent($holder,callbacks,'scroll'));$editable.on('paste',bindCustomEvent($holder,callbacks,'paste')); // [workaround] IE doesn't have input events for contentEditable\n//  - see: https://goo.gl/4bfIvA\nvar changeEventName=agent.isMSIE?'DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted':'input';$editable.on(changeEventName,function(){bindCustomEvent($holder,callbacks,'change')($editable.html(),$editable);});if(!options.airMode){layoutInfo.toolbar().click(bindCustomEvent($holder,callbacks,'toolbar.click'));layoutInfo.popover().click(bindCustomEvent($holder,callbacks,'popover.click'));} // Textarea: auto filling the code before form submit.\nif(dom.isTextarea(list.head($holder))){$holder.closest('form').submit(function(e){layoutInfo.holder().val(layoutInfo.holder().code());bindCustomEvent($holder,callbacks,'submit').call(this,e,$holder.code());});} // textarea auto sync\nif(dom.isTextarea(list.head($holder))&&options.textareaAutoSync){$holder.on('summernote.change',function(){layoutInfo.holder().val(layoutInfo.holder().code());});} // fire init event\nbindCustomEvent($holder,callbacks,'init')(layoutInfo); // fire plugin init event\nfor(var i=0,len=$.summernote.plugins.length;i<len;i++){if($.isFunction($.summernote.plugins[i].init)){$.summernote.plugins[i].init(layoutInfo);}}};this.detach=function(layoutInfo,options){layoutInfo.holder().off();layoutInfo.editable().off();layoutInfo.popover().off();layoutInfo.handle().off();layoutInfo.dialog().off();if(!options.airMode){layoutInfo.dropzone().off();layoutInfo.toolbar().off();layoutInfo.statusbar().off();}};}; /**\n   * @class Renderer\n   *\n   * renderer\n   *\n   * rendering toolbar and editable\n   */var Renderer=function Renderer(){ /**\n     * bootstrap button template\n     * @private\n     * @param {String} label button name\n     * @param {Object} [options] button options\n     * @param {String} [options.event] data-event\n     * @param {String} [options.className] button's class name\n     * @param {String} [options.value] data-value\n     * @param {String} [options.title] button's title for popup\n     * @param {String} [options.dropdown] dropdown html\n     * @param {String} [options.hide] data-hide\n     */var tplButton=function tplButton(label,options){var event=options.event;var value=options.value;var title=options.title;var className=options.className;var dropdown=options.dropdown;var hide=options.hide;return (dropdown?'<div class=\"btn-group'+(className?' '+className:'')+'\">':'')+'<button type=\"button\"'+' class=\"btn btn-default btn-sm'+(!dropdown&&className?' '+className:'')+(dropdown?' dropdown-toggle':'')+'\"'+(dropdown?' data-toggle=\"dropdown\"':'')+(title?' title=\"'+title+'\"':'')+(event?' data-event=\"'+event+'\"':'')+(value?' data-value=\\''+value+'\\'':'')+(hide?' data-hide=\\''+hide+'\\'':'')+' tabindex=\"-1\">'+label+(dropdown?' <span class=\"caret\"></span>':'')+'</button>'+(dropdown||'')+(dropdown?'</div>':'');}; /**\n     * bootstrap icon button template\n     * @private\n     * @param {String} iconClassName\n     * @param {Object} [options]\n     * @param {String} [options.event]\n     * @param {String} [options.value]\n     * @param {String} [options.title]\n     * @param {String} [options.dropdown]\n     */var tplIconButton=function tplIconButton(iconClassName,options){var label='<i class=\"'+iconClassName+'\"></i>';return tplButton(label,options);}; /**\n     * bootstrap popover template\n     * @private\n     * @param {String} className\n     * @param {String} content\n     */var tplPopover=function tplPopover(className,content){var $popover=$('<div class=\"'+className+' popover bottom in\" style=\"display: none;\">'+'<div class=\"arrow\"></div>'+'<div class=\"popover-content\">'+'</div>'+'</div>');$popover.find('.popover-content').append(content);return $popover;}; /**\n     * bootstrap dialog template\n     *\n     * @param {String} className\n     * @param {String} [title='']\n     * @param {String} body\n     * @param {String} [footer='']\n     */var tplDialog=function tplDialog(className,title,body,footer){return '<div class=\"'+className+' modal\" aria-hidden=\"false\">'+'<div class=\"modal-dialog\">'+'<div class=\"modal-content\">'+(title?'<div class=\"modal-header\">'+'<button type=\"button\" class=\"close\" aria-hidden=\"true\" tabindex=\"-1\">&times;</button>'+'<h4 class=\"modal-title\">'+title+'</h4>'+'</div>':'')+'<div class=\"modal-body\">'+body+'</div>'+(footer?'<div class=\"modal-footer\">'+footer+'</div>':'')+'</div>'+'</div>'+'</div>';}; /**\n     * bootstrap dropdown template\n     *\n     * @param {String|String[]} contents\n     * @param {String} [className='']\n     * @param {String} [nodeName='']\n     */var tplDropdown=function tplDropdown(contents,className,nodeName){var classes='dropdown-menu'+(className?' '+className:'');nodeName=nodeName||'ul';if(contents instanceof Array){contents=contents.join('');}return '<'+nodeName+' class=\"'+classes+'\">'+contents+'</'+nodeName+'>';};var tplButtonInfo={picture:function picture(lang,options){return tplIconButton(options.iconPrefix+options.icons.image.image,{event:'showImageDialog',title:lang.image.image,hide:true});},link:function link(lang,options){return tplIconButton(options.iconPrefix+options.icons.link.link,{event:'showLinkDialog',title:lang.link.link,hide:true});},table:function table(lang,options){var dropdown=['<div class=\"note-dimension-picker\">','<div class=\"note-dimension-picker-mousecatcher\" data-event=\"insertTable\" data-value=\"1x1\"></div>','<div class=\"note-dimension-picker-highlighted\"></div>','<div class=\"note-dimension-picker-unhighlighted\"></div>','</div>','<div class=\"note-dimension-display\"> 1 x 1 </div>'];return tplIconButton(options.iconPrefix+options.icons.table.table,{title:lang.table.table,dropdown:tplDropdown(dropdown,'note-table')});},style:function style(lang,options){var items=options.styleTags.reduce(function(memo,v){var label=lang.style[v==='p'?'normal':v];return memo+'<li><a data-event=\"formatBlock\" href=\"#\" data-value=\"'+v+'\">'+(v==='p'||v==='pre'?label:'<'+v+'>'+label+'</'+v+'>')+'</a></li>';},'');return tplIconButton(options.iconPrefix+options.icons.style.style,{title:lang.style.style,dropdown:tplDropdown(items)});},fontname:function fontname(lang,options){var realFontList=[];var items=options.fontNames.reduce(function(memo,v){if(!agent.isFontInstalled(v)&&!list.contains(options.fontNamesIgnoreCheck,v)){return memo;}realFontList.push(v);return memo+'<li><a data-event=\"fontName\" href=\"#\" data-value=\"'+v+'\" style=\"font-family:\\''+v+'\\'\">'+'<i class=\"'+options.iconPrefix+options.icons.misc.check+'\"></i> '+v+'</a></li>';},'');var hasDefaultFont=agent.isFontInstalled(options.defaultFontName);var defaultFontName=hasDefaultFont?options.defaultFontName:realFontList[0];var label='<span class=\"note-current-fontname\">'+defaultFontName+'</span>';return tplButton(label,{title:lang.font.name,className:'note-fontname',dropdown:tplDropdown(items,'note-check')});},fontsize:function fontsize(lang,options){var items=options.fontSizes.reduce(function(memo,v){return memo+'<li><a data-event=\"fontSize\" href=\"#\" data-value=\"'+v+'\">'+'<i class=\"'+options.iconPrefix+options.icons.misc.check+'\"></i> '+v+'</a></li>';},'');var label='<span class=\"note-current-fontsize\">11</span>';return tplButton(label,{title:lang.font.size,className:'note-fontsize',dropdown:tplDropdown(items,'note-check')});},color:function color(lang,options){var colorButtonLabel='<i class=\"'+options.iconPrefix+options.icons.color.recent+'\" style=\"color:black;background-color:yellow;\"></i>';var colorButton=tplButton(colorButtonLabel,{className:'note-recent-color',title:lang.color.recent,event:'color',value:'{\"backColor\":\"yellow\"}'});var items=['<li><div class=\"btn-group\">','<div class=\"note-palette-title\">'+lang.color.background+'</div>','<div class=\"note-color-reset\" data-event=\"backColor\"',' data-value=\"inherit\" title=\"'+lang.color.transparent+'\">'+lang.color.setTransparent+'</div>','<div class=\"note-color-palette\" data-target-event=\"backColor\"></div>','</div><div class=\"btn-group\">','<div class=\"note-palette-title\">'+lang.color.foreground+'</div>','<div class=\"note-color-reset\" data-event=\"foreColor\" data-value=\"inherit\" title=\"'+lang.color.reset+'\">',lang.color.resetToDefault,'</div>','<div class=\"note-color-palette\" data-target-event=\"foreColor\"></div>','</div></li>'];var moreButton=tplButton('',{title:lang.color.more,dropdown:tplDropdown(items)});return colorButton+moreButton;},bold:function bold(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.bold,{event:'bold',title:lang.font.bold});},italic:function italic(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.italic,{event:'italic',title:lang.font.italic});},underline:function underline(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.underline,{event:'underline',title:lang.font.underline});},strikethrough:function strikethrough(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.strikethrough,{event:'strikethrough',title:lang.font.strikethrough});},superscript:function superscript(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.superscript,{event:'superscript',title:lang.font.superscript});},subscript:function subscript(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.subscript,{event:'subscript',title:lang.font.subscript});},clear:function clear(lang,options){return tplIconButton(options.iconPrefix+options.icons.font.clear,{event:'removeFormat',title:lang.font.clear});},ul:function ul(lang,options){return tplIconButton(options.iconPrefix+options.icons.lists.unordered,{event:'insertUnorderedList',title:lang.lists.unordered});},ol:function ol(lang,options){return tplIconButton(options.iconPrefix+options.icons.lists.ordered,{event:'insertOrderedList',title:lang.lists.ordered});},paragraph:function paragraph(lang,options){var leftButton=tplIconButton(options.iconPrefix+options.icons.paragraph.left,{title:lang.paragraph.left,event:'justifyLeft'});var centerButton=tplIconButton(options.iconPrefix+options.icons.paragraph.center,{title:lang.paragraph.center,event:'justifyCenter'});var rightButton=tplIconButton(options.iconPrefix+options.icons.paragraph.right,{title:lang.paragraph.right,event:'justifyRight'});var justifyButton=tplIconButton(options.iconPrefix+options.icons.paragraph.justify,{title:lang.paragraph.justify,event:'justifyFull'});var outdentButton=tplIconButton(options.iconPrefix+options.icons.paragraph.outdent,{title:lang.paragraph.outdent,event:'outdent'});var indentButton=tplIconButton(options.iconPrefix+options.icons.paragraph.indent,{title:lang.paragraph.indent,event:'indent'});var dropdown=['<div class=\"note-align btn-group\">',leftButton+centerButton+rightButton+justifyButton,'</div><div class=\"note-list btn-group\">',indentButton+outdentButton,'</div>'];return tplIconButton(options.iconPrefix+options.icons.paragraph.paragraph,{title:lang.paragraph.paragraph,dropdown:tplDropdown(dropdown,'','div')});},height:function height(lang,options){var items=options.lineHeights.reduce(function(memo,v){return memo+'<li><a data-event=\"lineHeight\" href=\"#\" data-value=\"'+parseFloat(v)+'\">'+'<i class=\"'+options.iconPrefix+options.icons.misc.check+'\"></i> '+v+'</a></li>';},'');return tplIconButton(options.iconPrefix+options.icons.font.height,{title:lang.font.height,dropdown:tplDropdown(items,'note-check')});},help:function help(lang,options){return tplIconButton(options.iconPrefix+options.icons.options.help,{event:'showHelpDialog',title:lang.options.help,hide:true});},fullscreen:function fullscreen(lang,options){return tplIconButton(options.iconPrefix+options.icons.options.fullscreen,{event:'fullscreen',title:lang.options.fullscreen});},codeview:function codeview(lang,options){return tplIconButton(options.iconPrefix+options.icons.options.codeview,{event:'codeview',title:lang.options.codeview});},undo:function undo(lang,options){return tplIconButton(options.iconPrefix+options.icons.history.undo,{event:'undo',title:lang.history.undo});},redo:function redo(lang,options){return tplIconButton(options.iconPrefix+options.icons.history.redo,{event:'redo',title:lang.history.redo});},hr:function hr(lang,options){return tplIconButton(options.iconPrefix+options.icons.hr.insert,{event:'insertHorizontalRule',title:lang.hr.insert});}};var tplPopovers=function tplPopovers(lang,options){var tplLinkPopover=function tplLinkPopover(){var linkButton=tplIconButton(options.iconPrefix+options.icons.link.edit,{title:lang.link.edit,event:'showLinkDialog',hide:true});var unlinkButton=tplIconButton(options.iconPrefix+options.icons.link.unlink,{title:lang.link.unlink,event:'unlink'});var content='<a href=\"http://www.google.com\" target=\"_blank\">www.google.com</a>&nbsp;&nbsp;'+'<div class=\"note-insert btn-group\">'+linkButton+unlinkButton+'</div>';return tplPopover('note-link-popover',content);};var tplImagePopover=function tplImagePopover(){var fullButton=tplButton('<span class=\"note-fontsize-10\">100%</span>',{title:lang.image.resizeFull,event:'resize',value:'1'});var halfButton=tplButton('<span class=\"note-fontsize-10\">50%</span>',{title:lang.image.resizeHalf,event:'resize',value:'0.5'});var quarterButton=tplButton('<span class=\"note-fontsize-10\">25%</span>',{title:lang.image.resizeQuarter,event:'resize',value:'0.25'});var leftButton=tplIconButton(options.iconPrefix+options.icons.image.floatLeft,{title:lang.image.floatLeft,event:'floatMe',value:'left'});var rightButton=tplIconButton(options.iconPrefix+options.icons.image.floatRight,{title:lang.image.floatRight,event:'floatMe',value:'right'});var justifyButton=tplIconButton(options.iconPrefix+options.icons.image.floatNone,{title:lang.image.floatNone,event:'floatMe',value:'none'});var roundedButton=tplIconButton(options.iconPrefix+options.icons.image.shapeRounded,{title:lang.image.shapeRounded,event:'imageShape',value:'img-rounded'});var circleButton=tplIconButton(options.iconPrefix+options.icons.image.shapeCircle,{title:lang.image.shapeCircle,event:'imageShape',value:'img-circle'});var thumbnailButton=tplIconButton(options.iconPrefix+options.icons.image.shapeThumbnail,{title:lang.image.shapeThumbnail,event:'imageShape',value:'img-thumbnail'});var noneButton=tplIconButton(options.iconPrefix+options.icons.image.shapeNone,{title:lang.image.shapeNone,event:'imageShape',value:''});var removeButton=tplIconButton(options.iconPrefix+options.icons.image.remove,{title:lang.image.remove,event:'removeMedia',value:'none'});var content=(options.disableResizeImage?'':'<div class=\"btn-group\">'+fullButton+halfButton+quarterButton+'</div>')+'<div class=\"btn-group\">'+leftButton+rightButton+justifyButton+'</div><br>'+'<div class=\"btn-group\">'+roundedButton+circleButton+thumbnailButton+noneButton+'</div>'+'<div class=\"btn-group\">'+removeButton+'</div>';return tplPopover('note-image-popover',content);};var tplAirPopover=function tplAirPopover(){var $content=$('<div />');for(var idx=0,len=options.airPopover.length;idx<len;idx++){var group=options.airPopover[idx];var $group=$('<div class=\"note-'+group[0]+' btn-group\">');for(var i=0,lenGroup=group[1].length;i<lenGroup;i++){var $button=$(tplButtonInfo[group[1][i]](lang,options));$button.attr('data-name',group[1][i]);$group.append($button);}$content.append($group);}return tplPopover('note-air-popover',$content.children());};var $notePopover=$('<div class=\"note-popover\" />');$notePopover.append(tplLinkPopover());$notePopover.append(tplImagePopover());if(options.airMode){$notePopover.append(tplAirPopover());}return $notePopover;};var tplHandles=function tplHandles(options){return '<div class=\"note-handle\">'+'<div class=\"note-control-selection\">'+'<div class=\"note-control-selection-bg\"></div>'+'<div class=\"note-control-holder note-control-nw\"></div>'+'<div class=\"note-control-holder note-control-ne\"></div>'+'<div class=\"note-control-holder note-control-sw\"></div>'+'<div class=\"'+(options.disableResizeImage?'note-control-holder':'note-control-sizing')+' note-control-se\"></div>'+(options.disableResizeImage?'':'<div class=\"note-control-selection-info\"></div>')+'</div>'+'</div>';}; /**\n     * shortcut table template\n     * @param {String} title\n     * @param {String} body\n     */var tplShortcut=function tplShortcut(title,keys){var keyClass='note-shortcut-col col-xs-6 note-shortcut-';var body=[];for(var i in keys){if(keys.hasOwnProperty(i)){body.push('<div class=\"'+keyClass+'key\">'+keys[i].kbd+'</div>'+'<div class=\"'+keyClass+'name\">'+keys[i].text+'</div>');}}return '<div class=\"note-shortcut-row row\"><div class=\"'+keyClass+'title col-xs-offset-6\">'+title+'</div></div>'+'<div class=\"note-shortcut-row row\">'+body.join('</div><div class=\"note-shortcut-row row\">')+'</div>';};var tplShortcutText=function tplShortcutText(lang){var keys=[{kbd:'â + B',text:lang.font.bold},{kbd:'â + I',text:lang.font.italic},{kbd:'â + U',text:lang.font.underline},{kbd:'â + \\\\',text:lang.font.clear}];return tplShortcut(lang.shortcut.textFormatting,keys);};var tplShortcutAction=function tplShortcutAction(lang){var keys=[{kbd:'â + Z',text:lang.history.undo},{kbd:'â + â§ + Z',text:lang.history.redo},{kbd:'â + ]',text:lang.paragraph.indent},{kbd:'â + [',text:lang.paragraph.outdent},{kbd:'â + ENTER',text:lang.hr.insert}];return tplShortcut(lang.shortcut.action,keys);};var tplShortcutPara=function tplShortcutPara(lang){var keys=[{kbd:'â + â§ + L',text:lang.paragraph.left},{kbd:'â + â§ + E',text:lang.paragraph.center},{kbd:'â + â§ + R',text:lang.paragraph.right},{kbd:'â + â§ + J',text:lang.paragraph.justify},{kbd:'â + â§ + NUM7',text:lang.lists.ordered},{kbd:'â + â§ + NUM8',text:lang.lists.unordered}];return tplShortcut(lang.shortcut.paragraphFormatting,keys);};var tplShortcutStyle=function tplShortcutStyle(lang){var keys=[{kbd:'â + NUM0',text:lang.style.normal},{kbd:'â + NUM1',text:lang.style.h1},{kbd:'â + NUM2',text:lang.style.h2},{kbd:'â + NUM3',text:lang.style.h3},{kbd:'â + NUM4',text:lang.style.h4},{kbd:'â + NUM5',text:lang.style.h5},{kbd:'â + NUM6',text:lang.style.h6}];return tplShortcut(lang.shortcut.documentStyle,keys);};var tplExtraShortcuts=function tplExtraShortcuts(lang,options){var extraKeys=options.extraKeys;var keys=[];for(var key in extraKeys){if(extraKeys.hasOwnProperty(key)){keys.push({kbd:key,text:extraKeys[key]});}}return tplShortcut(lang.shortcut.extraKeys,keys);};var tplShortcutTable=function tplShortcutTable(lang,options){var colClass='class=\"note-shortcut note-shortcut-col col-sm-6 col-xs-12\"';var template=['<div '+colClass+'>'+tplShortcutAction(lang,options)+'</div>'+'<div '+colClass+'>'+tplShortcutText(lang,options)+'</div>','<div '+colClass+'>'+tplShortcutStyle(lang,options)+'</div>'+'<div '+colClass+'>'+tplShortcutPara(lang,options)+'</div>'];if(options.extraKeys){template.push('<div '+colClass+'>'+tplExtraShortcuts(lang,options)+'</div>');}return '<div class=\"note-shortcut-row row\">'+template.join('</div><div class=\"note-shortcut-row row\">')+'</div>';};var replaceMacKeys=function replaceMacKeys(sHtml){return sHtml.replace(/â/g,'Ctrl').replace(/â§/g,'Shift');};var tplDialogInfo={image:function image(lang,options){var imageLimitation='';if(options.maximumImageFileSize){var unit=Math.floor(Math.log(options.maximumImageFileSize)/Math.log(1024));var readableSize=(options.maximumImageFileSize/Math.pow(1024,unit)).toFixed(2)*1+' '+' KMGTP'[unit]+'B';imageLimitation='<small>'+lang.image.maximumFileSize+' : '+readableSize+'</small>';}var body='<div class=\"form-group row note-group-select-from-files\">'+'<label>'+lang.image.selectFromFiles+'</label>'+'<input class=\"note-image-input form-control\" type=\"file\" name=\"files\" accept=\"image/*\" multiple=\"multiple\" />'+imageLimitation+'</div>'+'<div class=\"form-group row\">'+'<label>'+lang.image.url+'</label>'+'<input class=\"note-image-url form-control col-md-12\" type=\"text\" />'+'</div>';var footer='<button href=\"#\" class=\"btn btn-primary note-image-btn disabled\" disabled>'+lang.image.insert+'</button>';return tplDialog('note-image-dialog',lang.image.insert,body,footer);},link:function link(lang,options){var body='<div class=\"form-group row\">'+'<label>'+lang.link.textToDisplay+'</label>'+'<input class=\"note-link-text form-control col-md-12\" type=\"text\" />'+'</div>'+'<div class=\"form-group row\">'+'<label>'+lang.link.url+'</label>'+'<input class=\"note-link-url form-control col-md-12\" type=\"text\" value=\"http://\" />'+'</div>'+(!options.disableLinkTarget?'<div class=\"checkbox\">'+'<label>'+'<input type=\"checkbox\" checked> '+lang.link.openInNewWindow+'</label>'+'</div>':'');var footer='<button href=\"#\" class=\"btn btn-primary note-link-btn disabled\" disabled>'+lang.link.insert+'</button>';return tplDialog('note-link-dialog',lang.link.insert,body,footer);},help:function help(lang,options){var body='<a class=\"modal-close pull-right\" aria-hidden=\"true\" tabindex=\"-1\">'+lang.shortcut.close+'</a>'+'<div class=\"title\">'+lang.shortcut.shortcuts+'</div>'+(agent.isMac?tplShortcutTable(lang,options):replaceMacKeys(tplShortcutTable(lang,options)))+'<p class=\"text-center\">'+'<a href=\"//summernote.org/\" target=\"_blank\">Summernote 0.6.16</a> Â· '+'<a href=\"//github.com/summernote/summernote\" target=\"_blank\">Project</a> Â· '+'<a href=\"//github.com/summernote/summernote/issues\" target=\"_blank\">Issues</a>'+'</p>';return tplDialog('note-help-dialog','',body,'');}};var tplDialogs=function tplDialogs(lang,options){var dialogs='';$.each(tplDialogInfo,function(idx,tplDialog){dialogs+=tplDialog(lang,options);});return '<div class=\"note-dialog\">'+dialogs+'</div>';};var tplStatusbar=function tplStatusbar(){return '<div class=\"note-resizebar\">'+'<div class=\"note-icon-bar\"></div>'+'<div class=\"note-icon-bar\"></div>'+'<div class=\"note-icon-bar\"></div>'+'</div>';};var representShortcut=function representShortcut(str){if(agent.isMac){str=str.replace('CMD','â').replace('SHIFT','â§');}return str.replace('BACKSLASH','\\\\').replace('SLASH','/').replace('LEFTBRACKET','[').replace('RIGHTBRACKET',']');}; /**\n     * createTooltip\n     *\n     * @param {jQuery} $container\n     * @param {Object} keyMap\n     * @param {String} [sPlacement]\n     */var createTooltip=function createTooltip($container,keyMap,sPlacement){var invertedKeyMap=func.invertObject(keyMap);var $buttons=$container.find('button');$buttons.each(function(i,elBtn){var $btn=$(elBtn);var sShortcut=invertedKeyMap[$btn.data('event')];if(sShortcut){$btn.attr('title',function(i,v){return v+' ('+representShortcut(sShortcut)+')';});} // bootstrap tooltip on btn-group bug\n// https://github.com/twbs/bootstrap/issues/5687\n}).tooltip({container:'body',trigger:'hover',placement:sPlacement||'top'}).on('click',function(){$(this).tooltip('hide');});}; // createPalette\nvar createPalette=function createPalette($container,options){var colorInfo=options.colors;$container.find('.note-color-palette').each(function(){var $palette=$(this),eventName=$palette.attr('data-target-event');var paletteContents=[];for(var row=0,lenRow=colorInfo.length;row<lenRow;row++){var colors=colorInfo[row];var buttons=[];for(var col=0,lenCol=colors.length;col<lenCol;col++){var color=colors[col];buttons.push(['<button type=\"button\" class=\"note-color-btn\" style=\"background-color:',color,';\" data-event=\"',eventName,'\" data-value=\"',color,'\" title=\"',color,'\" data-toggle=\"button\" tabindex=\"-1\"></button>'].join(''));}paletteContents.push('<div class=\"note-color-row\">'+buttons.join('')+'</div>');}$palette.html(paletteContents.join(''));});}; /**\n     * create summernote layout (air mode)\n     *\n     * @param {jQuery} $holder\n     * @param {Object} options\n     */this.createLayoutByAirMode=function($holder,options){var langInfo=options.langInfo;var keyMap=options.keyMap[agent.isMac?'mac':'pc'];var id=func.uniqueId();$holder.addClass('note-air-editor note-editable panel-body');$holder.attr({'id':'note-editor-'+id,'contentEditable':true});var body=document.body; // create Popover\nvar $popover=$(tplPopovers(langInfo,options));$popover.addClass('note-air-layout');$popover.attr('id','note-popover-'+id);$popover.appendTo(body);createTooltip($popover,keyMap);createPalette($popover,options); // create Handle\nvar $handle=$(tplHandles(options));$handle.addClass('note-air-layout');$handle.attr('id','note-handle-'+id);$handle.appendTo(body); // create Dialog\nvar $dialog=$(tplDialogs(langInfo,options));$dialog.addClass('note-air-layout');$dialog.attr('id','note-dialog-'+id);$dialog.find('button.close, a.modal-close').click(function(){$(this).closest('.modal').modal('hide');});$dialog.appendTo(body);}; /**\n     * create summernote layout (normal mode)\n     *\n     * @param {jQuery} $holder\n     * @param {Object} options\n     */this.createLayoutByFrame=function($holder,options){var langInfo=options.langInfo; //01. create Editor\nvar $editor=$('<div class=\"note-editor panel panel-default\" />');if(options.width){$editor.width(options.width);} //02. statusbar (resizebar)\nif(options.height>0){$('<div class=\"note-statusbar\">'+(options.disableResizeEditor?'':tplStatusbar())+'</div>').prependTo($editor);} //03 editing area\nvar $editingArea=$('<div class=\"note-editing-area\" />'); //03. create editable\nvar isContentEditable=!$holder.is(':disabled');var $editable=$('<div class=\"note-editable panel-body\" contentEditable=\"'+isContentEditable+'\"></div>').prependTo($editingArea);if(options.height){$editable.height(options.height);}if(options.direction){$editable.attr('dir',options.direction);}var placeholder=$holder.attr('placeholder')||options.placeholder;if(placeholder){$editable.attr('data-placeholder',placeholder);}$editable.html(dom.html($holder)||dom.emptyPara); //031. create codable\n$('<textarea class=\"note-codable\"></textarea>').prependTo($editingArea); //04. create Popover\nvar $popover=$(tplPopovers(langInfo,options)).prependTo($editingArea);createPalette($popover,options);createTooltip($popover,keyMap); //05. handle(control selection, ...)\n$(tplHandles(options)).prependTo($editingArea);$editingArea.prependTo($editor); //06. create Toolbar\nvar $toolbar=$('<div class=\"note-toolbar panel-heading\" />');for(var idx=0,len=options.toolbar.length;idx<len;idx++){var groupName=options.toolbar[idx][0];var groupButtons=options.toolbar[idx][1];var $group=$('<div class=\"note-'+groupName+' btn-group\" />');for(var i=0,btnLength=groupButtons.length;i<btnLength;i++){var buttonInfo=tplButtonInfo[groupButtons[i]]; // continue creating toolbar even if a button doesn't exist\nif(!$.isFunction(buttonInfo)){continue;}var $button=$(buttonInfo(langInfo,options));$button.attr('data-name',groupButtons[i]); // set button's alias, becuase to get button element from $toolbar\n$group.append($button);}$toolbar.append($group);}var keyMap=options.keyMap[agent.isMac?'mac':'pc'];createPalette($toolbar,options);createTooltip($toolbar,keyMap,'bottom');$toolbar.prependTo($editor); //07. create Dropzone\n$('<div class=\"note-dropzone\"><div class=\"note-dropzone-message\"></div></div>').prependTo($editor); //08. create Dialog\nvar $dialogContainer=options.dialogsInBody?$(document.body):$editor;var $dialog=$(tplDialogs(langInfo,options)).prependTo($dialogContainer);$dialog.find('button.close, a.modal-close').click(function(){$(this).closest('.modal').modal('hide');}); //09. Editor/Holder switch\n$editor.insertAfter($holder);$holder.hide();};this.hasNoteEditor=function($holder){return this.noteEditorFromHolder($holder).length>0;};this.noteEditorFromHolder=function($holder){if($holder.hasClass('note-air-editor')){return $holder;}else if($holder.next().hasClass('note-editor')){return $holder.next();}else {return $();}}; /**\n     * create summernote layout\n     *\n     * @param {jQuery} $holder\n     * @param {Object} options\n     */this.createLayout=function($holder,options){if(options.airMode){this.createLayoutByAirMode($holder,options);}else {this.createLayoutByFrame($holder,options);}}; /**\n     * returns layoutInfo from holder\n     *\n     * @param {jQuery} $holder - placeholder\n     * @return {Object}\n     */this.layoutInfoFromHolder=function($holder){var $editor=this.noteEditorFromHolder($holder);if(!$editor.length){return;} // connect $holder to $editor\n$editor.data('holder',$holder);return dom.buildLayoutInfo($editor);}; /**\n     * removeLayout\n     *\n     * @param {jQuery} $holder - placeholder\n     * @param {Object} layoutInfo\n     * @param {Object} options\n     *\n     */this.removeLayout=function($holder,layoutInfo,options){if(options.airMode){$holder.removeClass('note-air-editor note-editable').removeAttr('id contentEditable');layoutInfo.popover().remove();layoutInfo.handle().remove();layoutInfo.dialog().remove();}else {$holder.html(layoutInfo.editable().html());if(options.dialogsInBody){layoutInfo.dialog().remove();}layoutInfo.editor().remove();$holder.show();}}; /**\n     *\n     * @return {Object}\n     * @return {function(label, options=):string} return.button {@link #tplButton function to make text button}\n     * @return {function(iconClass, options=):string} return.iconButton {@link #tplIconButton function to make icon button}\n     * @return {function(className, title=, body=, footer=):string} return.dialog {@link #tplDialog function to make dialog}\n     */this.getTemplate=function(){return {button:tplButton,iconButton:tplIconButton,dialog:tplDialog};}; /**\n     * add button information\n     *\n     * @param {String} name button name\n     * @param {Function} buttonInfo function to make button, reference to {@link #tplButton},{@link #tplIconButton}\n     */this.addButtonInfo=function(name,buttonInfo){tplButtonInfo[name]=buttonInfo;}; /**\n     *\n     * @param {String} name\n     * @param {Function} dialogInfo function to make dialog, reference to {@link #tplDialog}\n     */this.addDialogInfo=function(name,dialogInfo){tplDialogInfo[name]=dialogInfo;};}; // jQuery namespace for summernote\n/**\n   * @class $.summernote \n   * \n   * summernote attribute  \n   * \n   * @mixin defaults\n   * @singleton  \n   * \n   */$.summernote=$.summernote||{}; // extends default settings\n//  - $.summernote.version\n//  - $.summernote.options\n//  - $.summernote.lang\n$.extend($.summernote,defaults);var renderer=new Renderer();var eventHandler=new EventHandler();$.extend($.summernote,{ /** @property {Renderer} */renderer:renderer, /** @property {EventHandler} */eventHandler:eventHandler, /** \n     * @property {Object} core \n     * @property {core.agent} core.agent \n     * @property {core.dom} core.dom\n     * @property {core.range} core.range \n     */core:{agent:agent,list:list,dom:dom,range:range}, /** \n     * @property {Object} \n     * pluginEvents event list for plugins\n     * event has name and callback function.\n     * \n     * ``` \n     * $.summernote.addPlugin({\n     *     events : {\n     *          'hello' : function(layoutInfo, value, $target) {\n     *              console.log('event name is hello, value is ' + value );\n     *          }\n     *     }     \n     * })\n     * ```\n     * \n     * * event name is data-event property.\n     * * layoutInfo is a summernote layout information.\n     * * value is data-value property.\n     */pluginEvents:{},plugins:[]}); /**\n   * @method addPlugin\n   *\n   * add Plugin in Summernote \n   * \n   * Summernote can make a own plugin.\n   *\n   * ### Define plugin\n   * ```\n   * // get template function  \n   * var tmpl = $.summernote.renderer.getTemplate();\n   * \n   * // add a button   \n   * $.summernote.addPlugin({\n   *     buttons : {\n   *        // \"hello\"  is button's namespace.      \n   *        \"hello\" : function(lang, options) {\n   *            // make icon button by template function          \n   *            return tmpl.iconButton(options.iconPrefix + 'header', {\n   *                // callback function name when button clicked \n   *                event : 'hello',\n   *                // set data-value property                 \n   *                value : 'hello',                \n   *                hide : true\n   *            });           \n   *        }\n   *     \n   *     }, \n   *     \n   *     events : {\n   *        \"hello\" : function(layoutInfo, value) {\n   *            // here is event code \n   *        }\n   *     }     \n   * });\n   * ``` \n   * ### Use a plugin in toolbar\n   * \n   * ``` \n   *    $(\"#editor\").summernote({\n   *    ...\n   *    toolbar : [\n   *        // display hello plugin in toolbar     \n   *        ['group', [ 'hello' ]]\n   *    ]\n   *    ...    \n   *    });\n   * ```\n   *  \n   *  \n   * @param {Object} plugin\n   * @param {Object} [plugin.buttons] define plugin button. for detail, see to Renderer.addButtonInfo\n   * @param {Object} [plugin.dialogs] define plugin dialog. for detail, see to Renderer.addDialogInfo\n   * @param {Object} [plugin.events] add event in $.summernote.pluginEvents \n   * @param {Object} [plugin.langs] update $.summernote.lang\n   * @param {Object} [plugin.options] update $.summernote.options\n   */$.summernote.addPlugin=function(plugin){ // save plugin list\n$.summernote.plugins.push(plugin);if(plugin.buttons){$.each(plugin.buttons,function(name,button){renderer.addButtonInfo(name,button);});}if(plugin.dialogs){$.each(plugin.dialogs,function(name,dialog){renderer.addDialogInfo(name,dialog);});}if(plugin.events){$.each(plugin.events,function(name,event){$.summernote.pluginEvents[name]=event;});}if(plugin.langs){$.each(plugin.langs,function(locale,lang){if($.summernote.lang[locale]){$.extend($.summernote.lang[locale],lang);}});}if(plugin.options){$.extend($.summernote.options,plugin.options);}}; /*\n   * extend $.fn\n   */$.fn.extend({ /**\n     * @method\n     * Initialize summernote\n     *  - create editor layout and attach Mouse and keyboard events.\n     * \n     * ```\n     * $(\"#summernote\").summernote( { options ..} );\n     * ```\n     *   \n     * @member $.fn\n     * @param {Object|String} options reference to $.summernote.options\n     * @return {this}\n     */summernote:function summernote(){ // check first argument's type\n//  - {String}: External API call {{module}}.{{method}}\n//  - {Object}: init options\nvar type=$.type(list.head(arguments));var isExternalAPICalled=type==='string';var hasInitOptions=type==='object'; // extend default options with custom user options\nvar options=hasInitOptions?list.head(arguments):{};options=$.extend({},$.summernote.options,options);options.icons=$.extend({},$.summernote.options.icons,options.icons); // Include langInfo in options for later use, e.g. for image drag-n-drop\n// Setup language info with en-US as default\noptions.langInfo=$.extend(true,{},$.summernote.lang['en-US'],$.summernote.lang[options.lang]); // override plugin options\nif(!isExternalAPICalled&&hasInitOptions){for(var i=0,len=$.summernote.plugins.length;i<len;i++){var plugin=$.summernote.plugins[i];if(options.plugin[plugin.name]){$.summernote.plugins[i]=$.extend(true,plugin,options.plugin[plugin.name]);}}}this.each(function(idx,holder){var $holder=$(holder); // if layout isn't created yet, createLayout and attach events\nif(!renderer.hasNoteEditor($holder)){renderer.createLayout($holder,options);var layoutInfo=renderer.layoutInfoFromHolder($holder);$holder.data('layoutInfo',layoutInfo);eventHandler.attach(layoutInfo,options);eventHandler.attachCustomEvent(layoutInfo,options);}});var $first=this.first();if($first.length){var layoutInfo=renderer.layoutInfoFromHolder($first); // external API\nif(isExternalAPICalled){var moduleAndMethod=list.head(list.from(arguments));var args=list.tail(list.from(arguments)); // TODO now external API only works for editor\nvar params=[moduleAndMethod,layoutInfo.editable()].concat(args);return eventHandler.invoke.apply(eventHandler,params);}else if(options.focus){ // focus on first editable element for initialize editor\nlayoutInfo.editable().focus();}}return this;}, /**\n     * @method \n     * \n     * get the HTML contents of note or set the HTML contents of note.\n     *\n     * * get contents \n     * ```\n     * var content = $(\"#summernote\").code();\n     * ```\n     * * set contents \n     *\n     * ```\n     * $(\"#summernote\").code(html);\n     * ```\n     *\n     * @member $.fn \n     * @param {String} [html] - HTML contents(optional, set)\n     * @return {this|String} - context(set) or HTML contents of note(get).\n     */code:function code(html){ // get the HTML contents of note\nif(html===undefined){var $holder=this.first();if(!$holder.length){return;}var layoutInfo=renderer.layoutInfoFromHolder($holder);var $editable=layoutInfo&&layoutInfo.editable();if($editable&&$editable.length){var isCodeview=eventHandler.invoke('codeview.isActivated',layoutInfo);eventHandler.invoke('codeview.sync',layoutInfo);return isCodeview?layoutInfo.codable().val():layoutInfo.editable().html();}return dom.value($holder);} // set the HTML contents of note\nthis.each(function(i,holder){var layoutInfo=renderer.layoutInfoFromHolder($(holder));var $editable=layoutInfo&&layoutInfo.editable();if($editable){$editable.html(html);}});return this;}, /**\n     * @method\n     * \n     * destroy Editor Layout and detach Key and Mouse Event\n     *\n     * @member $.fn\n     * @return {this}\n     */destroy:function destroy(){this.each(function(idx,holder){var $holder=$(holder);if(!renderer.hasNoteEditor($holder)){return;}var info=renderer.layoutInfoFromHolder($holder);var options=info.editor().data('options');eventHandler.detach(info,options);renderer.removeLayout($holder,info,options);});return this;}});});\n\n},{}]},{},[1]);\n"],"file":"summernote.js","sourceRoot":"/source/"}